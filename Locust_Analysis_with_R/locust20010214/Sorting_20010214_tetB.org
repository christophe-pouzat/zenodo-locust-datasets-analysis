# -*- ispell-local-dictionary: "american" -*-
#+OPTIONS: ':nil *:t -:t ::t <:t H:3 \n:nil ^:nil arch:headline
#+OPTIONS: author:t broken-links:nil c:nil creator:nil
#+OPTIONS: d:(not "LOGBOOK") date:t e:t email:nil f:t inline:t num:t
#+OPTIONS: p:nil pri:nil prop:nil stat:t tags:t tasks:t tex:t
#+OPTIONS: timestamp:t title:t toc:t todo:t |:t
#+TITLE: Sorting data set 20010214 tetrode B (channels 2, 3, 5, 7)
#+AUTHOR: Christophe Pouzat
#+EMAIL: christophe.pouzat@parisdescartes.fr
#+LANGUAGE: en
#+SELECT_TAGS: export
#+EXCLUDE_TAGS: noexport
#+CREATOR: Emacs 25.1.1 (Org mode 9.0)
#+LaTeX_CLASS: koma-article
#+LaTeX_CLASS_OPTIONS: [koma,11pt]
#+LaTeX_HEADER: \usepackage{cmbright}
#+LaTeX_HEADER: \usepackage[round]{natbib}
#+LaTeX_HEADER: \usepackage{alltt}
#+LaTeX_HEADER: \usepackage[usenames,dvipsnames]{xcolor}
#+LaTeX_HEADER: \renewenvironment{verbatim}{\begin{alltt} \scriptsize \color{Bittersweet} \vspace{0.2cm} }{\vspace{0.2cm} \end{alltt} \normalsize \color{black}}
#+LaTeX_HEADER: \usepackage{listings}
#+LaTeX_HEADER: \lstloadlanguages{C,Gnuplot,bash,sh,R}
#+LaTeX_HEADER: \hypersetup{colorlinks=true,pagebackref=true}
#+PROPERTY: header-args:R :session *R*
#+PROPERTY: header-args:R :eval no-export
#+PROPERTY: header-args:R :output-dir locust20010214_tetB_fig

#+NAME: org-latex-set-up
#+BEGIN_SRC emacs-lisp :exports none :results silent 
(setq smartparens-mode nil)
(require 'ox-latex)
(setq org-export-latex-listings t)
(setq org-latex-listings 'listings)
(setq org-latex-listings-options
        '(("frame" "lines")
          ("basicstyle" "\\footnotesize")
          ("numbers" "left")
          ("numberstyle" "\\tiny")))
(add-to-list 'org-latex-classes
          '("koma-article"
             "\\documentclass{scrartcl}"
             ("\\section{%s}" . "\\section*{%s}")
             ("\\subsection{%s}" . "\\subsection*{%s}")
             ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
             ("\\paragraph{%s}" . "\\paragraph*{%s}")
             ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
(setq org-latex-pdf-process
      '("pdflatex -interaction nonstopmode -output-directory %o %f"
	"bibtex %b" 
	"pdflatex -interaction nonstopmode -output-directory %o %f" 
	"pdflatex -interaction nonstopmode -output-directory %o %f"))
#+END_SRC

* Introduction

This is the description of how to do the (spike) sorting of tetrode B (channels 2, 3, 5, 7) from data set =locust20010214=.

** Getting the data

The data are in file =locust20010214.hdf5= located on [[https://zenodo.org/record/21589][zenodo]] and can be downloaded interactivelly with a web browser or by typing at the command line:

#+NAME: wget-locust20010214
#+BEGIN_SRC sh :eval never
wget https://zenodo.org/record/21589/files/locust20010214_part1.hdf5
wget https://zenodo.org/record/21589/files/locust20010214_part2.hdf5
#+END_SRC

In the sequel I will assume that =R= has been started in the directory where the data were downloaded (in other words, the working direcory should be the one containing the data.

The data are in [[https://support.hdfgroup.org/HDF5/][HDF5]] format and the easiest way to get them into =R= is to install the =rhdf5= package from [[http://www.bioconductor.org/packages/release/bioc/html/rhdf5.html][Bioconductor]]. Once the installation is done, the library is loaded into =R= with:

#+NAME: load-rhdf5
#+BEGIN_SRC R :session *R*
library(rhdf5)
#+END_SRC

#+RESULTS: load-rhdf5
| rhdf5     |
| stats     |
| graphics  |
| grDevices |
| utils     |
| datasets  |
| methods   |
| base      |

We can then get a (long and detailed) listing of our data file content with (result not shown):

#+NAME: locust20010214.hdf5-h5ls
#+BEGIN_SRC R :eval never
h5ls("locust20010214_part1.hdf5")
#+END_SRC

We can get the content of =LabBook= =metadata= /from the shell/ with:

#+NAME: locust20010214_part1.hdf5-h5dump
#+BEGIN_SRC shell :results output :exports both :eval never
h5dump -a "LabBook" locust20010214_part1.hdf5
#+END_SRC

** Getting the code

The code can be sourced as follows:

#+NAME: get-code-4-sorting
#+BEGIN_SRC R :session *R* :results silent
source("https://raw.githubusercontent.com/christophe-pouzat/zenodo-locust-datasets-analysis/master/R_Sorting_Code/sorting_with_r.R")
#+END_SRC

A description of the functions contained in this file can be found at the following address: [[http://xtof.perso.math.cnrs.fr/locust.html]].

* Tetrode B (channels 2, 3, 5, 7) analysis

We now want to get our "model", that is a dictionnary of waveforms (one waveform per neuron and per recording site). To that end we are going to use the /last/ 60 s of data contained in the =Spontaneous_2= =Group= (in =HDF5= jargon). 

** Loading the data

So we start by loading the data from channels 2, 3, 5, 7 into =R=:

#+NAME: load-tetC-spontaneous-into-lD
#+BEGIN_SRC R :exports both :session *R*
lD = rbind(cbind(h5read("locust20010214_part1.hdf5", "/Spontaneous_2/trial_30/ch02"),
                 h5read("locust20010214_part1.hdf5", "/Spontaneous_2/trial_30/ch03"),
                 h5read("locust20010214_part1.hdf5", "/Spontaneous_2/trial_30/ch05"),
                 h5read("locust20010214_part1.hdf5", "/Spontaneous_2/trial_30/ch07")))
dim(lD)
#+END_SRC

#+RESULTS: load-tetC-spontaneous-into-lD
| 431548 |
|      4 |


** Five number summary

We get the [[https://en.wikipedia.org/wiki/Five-number_summary][Five number summary]] with:

#+NAME: lD-FNS-tetB
#+BEGIN_SRC R :exports both :session *R*
summary(lD,digits=2)
#+END_SRC

#+RESULTS: lD-FNS-tetB
| Min.   :  98 | Min.   : 610 | Min.   : 762 | Min.   : 475 |
| 1st Qu.:2011 | 1st Qu.:2015 | 1st Qu.:2017 | 1st Qu.:2014 |
| Median :2058 | Median :2057 | Median :2057 | Median :2059 |
| Mean   :2055 | Mean   :2055 | Mean   :2054 | Mean   :2056 |
| 3rd Qu.:2105 | 3rd Qu.:2099 | 3rd Qu.:2095 | 3rd Qu.:2102 |
| Max.   :3634 | Max.   :3076 | Max.   :2887 | Max.   :3143 |


It shows that the channels have very similar properties as far as the median and the inter-quartile range (IQR) are concerned. The minimum is much smaller on the first channel. This suggests that the largest spikes are going to be found here (remember that spikes are going mainly downwards).

** Plot the data

We "convert" the data matrix =lD= into a =time series= object with:

#+NAME: lD-to-ts-tetB
#+BEGIN_SRC R :session *R* :results silent
lD = ts(lD,start=0,freq=15e3)
#+END_SRC

We can then plot the whole data with (not shown since it makes a very figure):

#+NAME: plot-lD-tetB
#+BEGIN_SRC R :eval never
plot(lD)
#+END_SRC

** Data normalization

As always we normalize such that the [[https://en.wikipedia.org/wiki/Median_absolute_deviation][median absolute deviation]] (MAD) becomes 1:

#+NAME: lD-normalization-tetB
#+BEGIN_SRC R :session *R* :results silent
lD.mad = apply(lD,2,mad)
lD = t((t(lD)-apply(lD,2,median))/lD.mad)
lD = ts(lD,start=0,freq=15e3)
#+END_SRC

Once this is done we explore interactively the data with:

#+NAME: lD-explore-tetB
#+BEGIN_SRC R :eval never
explore(lD,col=c("black","grey70"))
#+END_SRC

Most spikes can be seen on the 4 recording sites, there are many different spike waveform and the signal to noise ratio is really good!

** Spike detection

Since the spikes are mainly going downwards, we will detect valleys instead of peaks:

#+NAME: lD-detect-spikes-tetB
#+BEGIN_SRC R :exports both :session *R* :results output
lDf = -lD
filter_length = 5
threshold_factor = 4
lDf = filter(lDf,rep(1,filter_length)/filter_length)
lDf[is.na(lDf)] = 0
lDf.mad = apply(lDf,2,mad)
lDf_mad_original = lDf.mad
lDf = t(t(lDf)/lDf_mad_original)
thrs = threshold_factor*c(1,1,1,1)
bellow.thrs = t(t(lDf) < thrs)
lDfr = lDf
lDfr[bellow.thrs] = 0
remove(lDf)
sp0 = peaks(apply(lDfr,1,sum),15)
remove(lDfr)
sp0
#+END_SRC

#+RESULTS: lD-detect-spikes-tetB
: 
: eventsPos object with indexes of 1950 events. 
:   Mean inter event interval: 221.2 sampling points, corresponding SD: 204.2 sampling points 
:   Smallest and largest inter event intervals: 16 and 2904 sampling points.



Every time a filter length / threshold combination is tried, the detection is checked interactively with:

#+NAME: lD-sp0-check-tetB
#+BEGIN_SRC R :eval never
explore(sp0,lD,col=c("black","grey50"))
#+END_SRC

** Cuts

We proceed as usual to get the cut length right:

#+NAME: cut-length-plot-tetB
#+HEADER: :width 800 :height 800 :file tetB_cut_length.png
#+BEGIN_SRC R :exports both :results output graphics :session *R*
evts = mkEvents(sp0,lD,49,50)
evts.med = median(evts)
evts.mad = apply(evts,1,mad)
plot_range = range(c(evts.med,evts.mad))
plot(evts.med,type="n",ylab="Amplitude",
     ylim=plot_range)
abline(v=seq(0,400,10),col="grey")
abline(h=c(0,1),col="grey")
lines(evts.med,lwd=2)
lines(evts.mad,col=2,lwd=2)
#+END_SRC

#+CAPTION: Setting the cut length for the data from tetrode B (channels 2, 3, 5, 7). We see that we need 20 points before the peak and 30 after.
#+RESULTS: cut-length-plot-tetB
[[file:locust20010214_tetB_fig/tetB_cut_length.png]]

We see that we need roughly 20 points before the peak and 30 after.

** Events

We now cut our events:

#+NAME: lD-events-tetB
#+BEGIN_SRC R :exports both :results output :session *R*
evts = mkEvents(sp0,lD,19,30)
summary(evts)
#+END_SRC

#+RESULTS: lD-events-tetB
: 
: events object deriving from data set: lD.
:  Events defined as cuts of 50 sampling points on each of the 4 recording sites.
:  The 'reference' time of each event is located at point 20 of the cut.
:  There are 1950 events in the object.


We can as usual visualize the first 200 events with:

#+NAME: first-200-evts-tetB
#+HEADER: :width 800 :height 800 :file first_200_evts_tetB.png
#+BEGIN_SRC R :exports both :results output graphics :session *R*
evts[,1:200]
#+END_SRC

#+CAPTION: First 200 events for the data from tetrode B (channels 1, 3, 5, 7).
#+RESULTS: first-200-evts-tetB
[[file:locust20010214_tetB_fig/first_200_evts_tetB.png]]

There are few superpositions so we try to remove the most obvious ones before doing the dimension reduction.

** Removing obvious superposition

We define function =goodEvtsFct= with:

#+NAME: goodEvtsFct
#+BEGIN_SRC R :session *R* :results silent
goodEvtsFct = function(samp,thr=3) {
    samp.med = apply(samp,1,median)
    samp.mad = apply(samp,1,mad)
    below = samp.med < 0
    samp.r = apply(samp,2,function(x) {x[below] = 0;x})
    apply(samp.r,2,function(x) all(abs(x-samp.med) < thr*samp.mad))
}
#+END_SRC

We apply it with a threshold of 8 times the MAD:

#+NAME: goodEvts-8-MAD
#+BEGIN_SRC R :session *R* :results silent
goodEvts = goodEvtsFct(evts,8)
#+END_SRC

 
** Dimension reduction

We do a =PCA= on our good events set:

#+NAME: lD-evts-pca-tetB
#+BEGIN_SRC R :session *R*
evts.pc = prcomp(t(evts[,goodEvts]))
#+END_SRC

#+RESULTS: lD-evts-pca-tetB

We look at the projections on the first 4 principle components:

#+NAME: lD-evts-proj-first-4-pc-tetB
#+HEADER: :width 800 :height 800 :file evts-proj-first-4-pc-tetB.png
#+BEGIN_SRC R :exports both :results output graphics :session *R*
panel.dens = function(x,...) {
  usr = par("usr")
  on.exit(par(usr))
  par(usr = c(usr[1:2], 0, 1.5) )
  d = density(x, adjust=0.5)
  x = d$x
  y = d$y
  y = y/max(y)
  lines(x, y, col="grey50", ...)
}
pairs(evts.pc$x[,1:4],pch=".",gap=0,diag.panel=panel.dens)
#+END_SRC

#+CAPTION: Events from tetrode B (channels 2, 3, 5, 7) projected onto the first 4 PCs.
#+RESULTS: lD-evts-proj-first-4-pc-tetB
[[file:locust20010214_tetB_fig/evts-proj-first-4-pc-tetB.png]]

I see at least 10 clusters. We can also look at the projections on the PC pairs defined by the next 4 PCs:

#+NAME: lD-evts-proj-next-4-pc-tetB
#+HEADER: :width 800 :height 800 :file evts-proj-next-4-pc-tetB.png
#+BEGIN_SRC R :exports both :results output graphics :session *R*
pairs(evts.pc$x[,5:8],pch=".",gap=0,diag.panel=panel.dens)
#+END_SRC

#+CAPTION: Events from tetrode B (channels 2, 3, 5, 7) projected onto PC 5 to 8.
#+RESULTS: lD-evts-proj-next-4-pc-tetB
[[file:locust20010214_tetB_fig/evts-proj-next-4-pc-tetB.png]]

There is not much structure left beyond the 4th PC.

** Exporting for =GGobi=

We export the events projected onto the first 8 principle components in =csv= format:

#+NAME: evts-proj-to-csv-tetB
#+BEGIN_SRC R :session *R*
write.csv(evts.pc$x[,1:8],file="tetB_evts.csv")
#+END_SRC

#+RESULTS: evts-proj-to-csv-tetB

Using the =rotation= display of =GGobi= with the first 3 principle components and the =2D tour= with the first 4 components I see at least 10. So we will start with a =kmeans= with 10 centers.

** kmeans clustering with 10

#+NAME: kmeans-10-tetB
#+BEGIN_SRC R :session *R* :results silent
nbc=10
set.seed(20110928,kind="Mersenne-Twister")
km = kmeans(evts.pc$x[,1:4],centers=nbc,iter.max=100,nstart=100)
label = km$cluster
cluster.med = sapply(1:nbc, function(cIdx) median(evts[,goodEvts][,label==cIdx]))
sizeC = sapply(1:nbc,function(cIdx) sum(abs(cluster.med[,cIdx])))
newOrder = sort.int(sizeC,decreasing=TRUE,index.return=TRUE)$ix
cluster.mad = sapply(1:nbc, function(cIdx) {ce = t(evts[,goodEvts]);ce = ce[label==cIdx,];apply(ce,2,mad)})
cluster.med = cluster.med[,newOrder]
cluster.mad = cluster.mad[,newOrder]
labelb = sapply(1:nbc, function(idx) (1:nbc)[newOrder==idx])[label]
#+END_SRC

 
We write a new =csv= file with the data and the labels:

#+NAME: evts-proj-and-labels-to-csv-tetB
#+BEGIN_SRC R :session *R* :results silent
write.csv(cbind(evts.pc$x[,1:4],labelb),file="tetB_sorted.csv")
#+END_SRC

It gives what was expected.

We get a plot showing the events attributed to each of the first 5 units with:

#+NAME: kmeans-10-evts-from-each-of-first-5-tetB
#+HEADER: :width 800 :height 1600 :file kmeans-10-evts-from-each-of-first-5-tetB.png
#+BEGIN_SRC R :results output graphics :exports both :session *R*
layout(matrix(1:5,nr=5))
par(mar=c(1,1,1,1))
for (i in (1:5)) plot(evts[,goodEvts][,labelb==i],y.bar=5)
#+END_SRC

#+CAPTION: The events of the first five clusters of tetrode B 
#+RESULTS: kmeans-10-evts-from-each-of-first-5-tetB
[[file:locust20010214_tetB_fig/kmeans-10-evts-from-each-of-first-5-tetB.png]]

We get a plot showing the events attributed to each of the last 5 units with:

#+NAME: kmeans-10-evts-from-each-of-last-5-tetB
#+HEADER: :width 800 :height 1600 :file kmeans-10-evts-from-each-of-last-5-tetB.png
#+BEGIN_SRC R :results output graphics :exports both :session *R*
layout(matrix(1:5,nr=5))
par(mar=c(1,1,1,1))
for (i in (6:10)) plot(evts[,goodEvts][,labelb==i],y.bar=5)
#+END_SRC

#+CAPTION: The events of the last five clusters of tetrode B 
#+RESULTS: kmeans-10-evts-from-each-of-last-5-tetB
[[file:locust20010214_tetB_fig/kmeans-10-evts-from-each-of-last-5-tetB.png]]


** Long cuts creation

For the peeling process we need templates that start and end at 0 (we will otherwise generate artifacts when we subtract). We proceed "as usual" with (I tried first with the default value for parameters =before= and =after= but I reduced their values after looking at the centers, see the next figure):

#+NAME: centers-tetB
#+BEGIN_SRC R :session *R*
c_before = 49
c_after = 80
centers = lapply(1:nbc, function(i)
    mk_center_list(sp0[goodEvts][labelb==i],lD,
                   before=c_before,after=c_after))
names(centers) = paste("Cluster",1:nbc)
#+END_SRC

#+RESULTS: centers-tetB
| Cluster 1  |
| Cluster 2  |
| Cluster 3  |
| Cluster 4  |
| Cluster 5  |
| Cluster 6  |
| Cluster 7  |
| Cluster 8  |
| Cluster 9  |
| Cluster 10 |


We then make sure that our cuts are long enough by looking at them (the first 5):

#+NAME: centers-10u-first-5-tetB-fig
#+HEADER: :width 800 :height 1600 :file centers-10u-first-5-tetB.png
#+BEGIN_SRC R :results output graphics :exports both :session *R*
layout(matrix(1:5,nr=5))
par(mar=c(1,4,1,1))
the_range=c(min(sapply(centers,function(l) min(l$center))),
            max(sapply(centers,function(l) max(l$center))))
for (i in 1:5) {
    template = centers[[i]]$center
    plot(template,lwd=2,col=2,
         ylim=the_range,type="l",ylab="")
    abline(h=0,col="grey50")
    abline(v=(1:2)*(c_before+c_after)+1,col="grey50")
    lines(filter(template,rep(1,filter_length)/filter_length),
          col=1,lty=3,lwd=2)
    abline(h=-threshold_factor,col="grey",lty=2,lwd=2)
    lines(centers[[i]]$centerD,lwd=2,col=4)
}
#+END_SRC

#+CAPTION: The first five templates (red) together with their first derivative (blue) all with the same scale. The dashed black curve show the templates filtered with the filter used during spike detection and the horizontal dashed grey line shows the detection threshold.
#+RESULTS: centers-10u-first-5-tetB-fig
[[file:locust20010214_tetB_fig/centers-10u-first-5-tetB.png]]

The last five:

#+NAME: centers-10u-last-5-tetB-fig
#+HEADER: :width 800 :height 1600 :file centers-10u-last-5-tetB.png
#+BEGIN_SRC R :results output graphics :exports both :session *R*
layout(matrix(1:5,nr=5))
par(mar=c(1,4,1,1))
the_range=c(min(sapply(centers,function(l) min(l$center))),
            max(sapply(centers,function(l) max(l$center))))
for (i in 6:10) {
    template = centers[[i]]$center
    plot(template,lwd=2,col=2,
         ylim=the_range,type="l",ylab="")
    abline(h=0,col="grey50")
    abline(v=(1:2)*(c_before+c_after)+1,col="grey50")
    lines(filter(template,rep(1,filter_length)/filter_length),
          col=1,lty=3,lwd=2)
    abline(h=-threshold_factor,col="grey",lty=2,lwd=2)
    lines(centers[[i]]$centerD,lwd=2,col=4)
}
#+END_SRC

#+RESULTS: centers-10u-last-5-tetB-fig
[[file:locust20010214_tetB_fig/centers-10u-last-5-tetB.png]]

#+CAPTION: The last five templates (red) together with their first derivative (blue) all with the same scale. The dashed black curve show the templates filtered with the filter used during spike detection and the horizontal dashed grey line shows the detection threshold.
#+RESULTS: centers-10u-last-4-tetB-fig
[[file:locust20010214_tetB_fig/centers-10u-last-4-tetB.png]]

We see that the last three units won't reliably pass our threshold...

** Peeling

We can now do the peeling.

*** Round 0

We classify, predict, subtract and check how many non-classified events we get:

#+NAME: peeling-0-10u-tetB
#+BEGIN_SRC R :exports both :session *R*
round0 = lapply(as.vector(sp0),classify_and_align_evt,
                data=lD,centers=centers,
                before=c_before,after=c_after)
pred0 = predict_data(round0,centers,data_length = dim(lD)[1])
lD_1 = lD - pred0
sum(sapply(round0, function(l) l[[1]] == '?'))
#+END_SRC

#+RESULTS: peeling-0-10u-tetB
: 19

We can see the difference before / after peeling for the data between 0.9 and 1.0 s:

#+NAME: peeling-0-10u-tetB-fig
#+HEADER: :width 800 :height 1000 :file peeling-0-10u-tetB.png
#+BEGIN_SRC R :results output graphics :exports both :session *R*
ii = 1:1500 + 0.9*15000
tt = ii/15000
par(mar=c(1,1,1,1))
plot(tt, lD[ii,1], axes = FALSE,
     type="l",ylim=c(-100,20),
     xlab="",ylab="")
lines(tt, lD_1[ii,1], col='red')
lines(tt, lD[ii,2]-30, col='black')
lines(tt, lD_1[ii,2]-30, col='red')
lines(tt, lD[ii,3]-50, col='black')
lines(tt, lD_1[ii,3]-50, col='red')
lines(tt, lD[ii,4]-80, col='black')
lines(tt, lD_1[ii,4]-80, col='red')
#+END_SRC

#+CAPTION: The first peeling illustrated on 100 ms of data, the raw data are in black and the first subtration in red.
#+RESULTS: peeling-0-10u-tetB-fig
[[file:locust20010214_tetB_fig/peeling-0-10u-tetB.png]]

*** Round 1

We keep going, using the subtracted data =lD_1= as "raw data", detecting on all sites using the original =MAD= for normalization:

#+NAME: peeling-1-10u-spike-detection-tetB
#+BEGIN_SRC R :exports both :results output :session *R*
lDf = -lD_1
lDf = filter(lDf,rep(1,filter_length)/filter_length)
lDf[is.na(lDf)] = 0
lDf = t(t(lDf)/lDf_mad_original)
thrs = threshold_factor*c(1,1,1,1)
bellow.thrs = t(t(lDf) < thrs)
lDfr = lDf
lDfr[bellow.thrs] = 0
remove(lDf)
sp1 = peaks(apply(lDfr,1,sum),15)
remove(lDfr)
sp1
#+END_SRC

#+RESULTS: peeling-1-10u-spike-detection-tetB
: 
: eventsPos object with indexes of 216 events. 
:   Mean inter event interval: 1974.81 sampling points, corresponding SD: 2223.81 sampling points 
:   Smallest and largest inter event intervals: 16 and 15982 sampling points.


We classify, predict, subtract and check how many non-classified events we get:

#+NAME: peeling-1-10u-tetB
#+BEGIN_SRC R :exports both :session *R*
round1 = lapply(as.vector(sp1),classify_and_align_evt,
                data=lD_1,centers=centers,
                before=c_before,after=c_after)
pred1 = predict_data(round1,centers,data_length = dim(lD)[1])
lD_2 = lD_1 - pred1
sum(sapply(round1, function(l) l[[1]] == '?'))
#+END_SRC

#+RESULTS: peeling-1-10u-tetB
: 21

We look at what's left with (not shown):

#+NAME: check-after-round1
#+BEGIN_SRC R :eval never
explore(sp1,lD_2,col=c("black","grey50"))
#+END_SRC

There is some stuff left but the big guys have disappeared so we decide to stop here.

** Getting the spike trains

#+NAME: spike-trains-10u-tetB
#+BEGIN_SRC R :session *R*
round_all = c(round0,round1)
spike_trains = lapply(paste("Cluster",1:nbc),
                      function(cn) sort(sapply(round_all[sapply(round_all,
                                                           function(l) l[[1]]==cn)],
                                          function(l) l[[2]]+l[[3]])))
names(spike_trains) = paste("Cluster",1:nbc)
#+END_SRC

#+RESULTS: spike-trains-10u-tetB
| Cluster 1  |
| Cluster 2  |
| Cluster 3  |
| Cluster 4  |
| Cluster 5  |
| Cluster 6  |
| Cluster 7  |
| Cluster 8  |
| Cluster 9  |
| Cluster 10 |

** Getting the inter spike intervals and the forward and backward recurrence times

*** ISI distributions
We first get the =ISI= (inter spike intervals) of each unit:

#+NAME: isi_from_each
#+BEGIN_SRC R :session *R* :results silent
isi = sapply(spike_trains, diff)
names(isi) = names(spike_trains)
#+END_SRC

We define a =plot_isi= function that plots the =ECDF= (empirical cumulative distribution function) of the =ISI=:

#+NAME: plot_isi
#+BEGIN_SRC R :session *R* :results silent
plot_isi = function(isi, ## vector of ISIs
                    xlab="ISI (s)",
                    ylab="ECFD",
                    xlim=c(0,0.5), 
                    sampling_frequency=15000,
                    ... ## additional arguments passed to plot
                    ) {
    isi = sort(isi)/sampling_frequency
    n = length(isi)
    plot(isi,(1:n)/n,type="s",
         xlab=xlab,ylab=ylab,
         xlim=xlim,...)
}
#+END_SRC

We get the ISI ECDF for the units with:

#+NAME: isi-ecdf-10u-tetB
#+HEADER: :width 800 :height 1600 :file isi-ecdf-10u-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout(matrix(1:(nbc+nbc %% 2),nr=ceiling(nbc/2)))
par(mar=c(4,5,6,1))
for (cn in names(isi)) plot_isi(isi[[cn]],main=cn)
#+END_SRC

#+CAPTION: ISI ECDF for the ten units.
#+RESULTS: isi-ecdf-10u-tetB
[[file:locust20010214_tetB_fig/isi-ecdf-10u-tetB.png]]

The first 7 look great the last three  are clearly multi-unit.

*** Forward and Backward Recurrence Times
The forward recurrence time (=FRT=) between neuron A and B is the elapsed time between a spike in A and the next spike in B. The backward recurrence time (=BRT=) is the same thing except that we look for the former spike in B. If A and B are not correlated, the expected density of the FRT is the survival function (1-CDF) of the ISI from B divided by the mean ISI of B (the same holds for the BRT under the null hypothesis after taking the opposite). All that is correct if the data are /stationary/.
  
We define a function =get_rt= that returns the =FRT= and =BRT= given two spike trains:

#+NAME: get_rt
#+BEGIN_SRC R :session *R* :results silent
get_rt = function(ref_train, 
                  test_train
                  ) {
    res=sapply(ref_train,
               function(t) c(max(test_train[test_train<=t])-t,
                             min(test_train[test_train>=t])-t)
               )
    res[,!apply(res,2,function(x) any(is.infinite(x)))]
}
#+END_SRC

We define next a function =test_rt= that plots a variance stabilized version of the histograms of the FRT and BRT minus the variance stabilized version under the null. The variance stabilization version is replacing the histogram bin counts $y$ by $\sqrt{y} + \sqrt{y+1}$. This transformation stabilizes the variance at 1.

#+NAME: test_rt
#+BEGIN_SRC R :session *R* :results silent
test_rt = function(ref_train, 
                   test_train,
                   sampling_frequency=15000,
                   nbins=50, ## the number of breaks in the histogram
		   single_trial_duration = ceiling(max(c(ref_train,test_train))/sampling_frequency), 
                   xlab="Recurrence time (s)",
                   ylab="Stabilized counts - stabilized expected counts",
		   subdivisions = 10000, ## argument of integrate
                   ... ## additional parameters passed to plot
                   ) {
    rt = ref_train/sampling_frequency
    tt = test_train/sampling_frequency
    rt_L = vector("list",0)
    tt_L = vector("list",0)
    idx_max = max(c(rt,tt))%/%single_trial_duration
    if ( idx_max == 0) {
        rt_L = list(rt)
        tt_L = list(tt)
    } else {
        idx = 0
        while (idx <= idx_max) {
            start_trial_time = idx*single_trial_duration
            end_trial_time = start_trial_time + single_trial_duration
            rt_t = rt[start_trial_time <= rt & rt < end_trial_time]
            tt_t = tt[start_trial_time <= tt & tt < end_trial_time]
            if (length(rt_t) > 0 && length(tt_t) > 0) {
                rt_L = c(rt_L,list(rt_t-start_trial_time))
                tt_L = c(tt_L,list(tt_t-start_trial_time))
            }
            idx = idx + 1
        }
    }
    tt_isi_L = lapply(tt_L,diff)
    it = unlist(tt_isi_L)
    p_it=ecdf(it) ## ECDF of ISI from test
    mu_it=mean(it)
    s_it=function(t) (1-p_it(t))/mu_it ## expected density of FRT/BRT under the null
    ## Get the BRT and FRT
    res = lapply(1:length(rt_L),
                 function(idx) {
                     rt_t = rt_L[[idx]]
                     tt_t = tt_L[[idx]]
                     rt_t = rt_t[min(tt_t) < rt_t & rt_t < max(tt_t)]
                     RT = sapply(rt_t,
                                 function(t) c(max(tt_t[tt_t<=t])-t,
                                               min(tt_t[tt_t>=t])-t)
                                 )
                 })
    frt = sort(unlist(lapply(res, function(l) l[2,])))
    brt = sort(-unlist(lapply(res, function(l) l[1,])))
    n = length(frt)
    frt_h = hist(frt,breaks=nbins,plot=FALSE)
    frt_c_s = sqrt(frt_h$counts)+sqrt(frt_h$counts+1) ## stabilized version of the FRT counts
    ## expected FRT counts under the null
    frt_c_e = sapply(1:(length(frt_h$breaks)-1),
                     function(i) integrate(s_it,frt_h$breaks[i],frt_h$breaks[i+1],subdivisions = subdivisions)$value
                     )
    frt_c_e_s = sqrt(frt_c_e*n) + sqrt(frt_c_e*n+1) ## stabilized version of the expected FRT counts
    brt_h = hist(brt,breaks=nbins,plot=FALSE)
    brt_c_s = sqrt(brt_h$counts)+sqrt(brt_h$counts+1) ## stabilized version of the BRT counts
    ## expected BRT counts under the null
    brt_c_e = sapply(1:(length(brt_h$breaks)-1),
                     function(i) integrate(s_it,brt_h$breaks[i],brt_h$breaks[i+1],subdivisions = subdivisions)$value
                     )
    brt_c_e_s = sqrt(brt_c_e*n) + sqrt(brt_c_e*n+1) ## stabilized version of the expected BRT counts
    X = c(rev(-brt_h$mids),frt_h$mids)
    Y = c(rev(brt_c_s-brt_c_e_s),frt_c_s-frt_c_e_s)
    plot(X,Y,type="n",
         xlab=xlab,
         ylab=ylab,
         ...)
    abline(h=0,col="grey")
    abline(v=0,col="grey")
    lines(X,Y,type="s")
}
#+END_SRC

Notice that =get_rt= is included in =test_rt= so we don't really need the former anymore.

On the data at hand that gives for the first 7 units:

#+NAME: rt-test-10u-tetB
#+HEADER: :width 1600 :height 1600 :file rt-test-10u-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(spike_trains[[i]],
                    spike_trains[[j]],
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distrution agaisnt the null hypothesis (no interaction). If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: rt-test-10u-tetB
[[file:locust20010214_tetB_fig/rt-test-10u-tetB.png]]

On this time scale with this number of events, we do not see signs of interactions.

** Making "all at once"

Now that we have classified a single trial we would like to classify the subsequent ones (from the same experiment and the same tetrode) without re-estimating the model every time. If the recording conditions were perfectly stable we could proceed rather easily and in fact to the job in parallel. There are nevertheless few sources of variability we should be ready to cope with:

- First and foremost we can observe a slow drift of the electrodes inducing a change in the relative positions of the neurons and the electrodes. This results in a change of the waveform generated by the neurons on the different recording sites. Since these drifts usually occur on a slow time scale (several minutes) the easiest way to deal with them is to /process the data sequentially, in the order in which they were recorded/ (that precludes the parallel processing alluded to above) and to make the templates evolve slowly by computing, at the end of each trial a weighted average of the templates just used and of the ones obtained by averaging the well isolated events that were just classified.
- A neuron can disappear (because it dies--don't forget that our probes are large and damage the neurons upon insertion--or because of the drift) or appear (because of the drift or "something else" like an hormonal regulation). In the latter case, the model (list of templates) should be updated to include a new element. In any case, the way to detect these appearances / disappearances is to monitor at the end of each trial classification the number of spikes attributed to each neuron of the model as well as the number of unclassified events.

*** What should our "all at once" function do?

The first thing is to print the five-number summary so that if something went really wrong (amplifier saturation, large noise increase) it will be readily detected. It is then a good idea to print after each peeling round the total number of detected events, the number of events attributed to each neuron and the number of unclassified events. At the end we want to print these same numbers obtained from the whole peeling procedure. The function will also return in a list the following elements:

- *prediction*: A predicted trace (the overall version of the previous =predX=).
- *residual*: A residual trace (the data minus the prediction).
- *classification*: The =round_all= object above.
- *unknown*: An =events= object containing the unclassified events (for quick monitoring in case of problems).
- *centers*: A version of =centers= computed from the data just analyzed (so that the user can make a weighted average at will).
- *counts*: A vector with the total number of events, the number of events from each neuron and the number of unclassified events.

Argument =verbose= controls the verbosity: if 0 nothing is printed to the =stdout=; if 1 the final results are printed; if 2 (default) the final and intermediate (following each peeling round) results are printed. A distinction is made between the first peeling round and the subsequent ones that can have different filter lengths (=filter_length_1= and =filter_length=) and different =minimalDist= arguments for the =peaks= function that is called internally. The channels on which the detection is performed at each peeling round is controlled by the corresponding element of vector =detection_cycle= (a value 0 for an element means that the detection is performed on all channels). 

*** =all_at_once= definition

So let us define our function:

#+NAME: all_at_once
#+BEGIN_SRC R :session *R* :results silent
all_at_once = function(data, ## an unormalized data matrix
                       centers, ## a list of centers
                       thres=4*c(1,1), ## threshold vector
                       filter_length_1=5, ## length of first filter
                       filter_length=5, ## length of subsequent filters
                       minimalDist_1=15, ## dead time length imposed at first detection
                       minimalDist=10, ## dead time length imposed at subsequent detection
                       before=c_before, ## parameter of centers
                       after=c_after, ## parameter of centers
                       detection_cycle=c(0,1,2,3,4), ## where is detection done during the peeling
                       verbose=2 ## verbosity level
                       ) {
    n_samples = dim(data)[1] ## Number of sample points
    n_chan = dim(data)[2] ## Number of channels
    n_rounds = length(detection_cycle)
    if (verbose > 0) {
        ## print five number summary
        cat("The five number summary is:\n")
        print(summary(data,digits=2))
        cat("\n")
    }
    ## normalize the data
    data.mad = apply(data,2,mad)
    data = t((t(data)-apply(data,2,median))/data.mad)
    filtered_data_mad = sapply(c(filter_length_1,filter_length),
                               function(l) {
                                   lDf = -data
                                   lDf = filter(lDf,rep(1,l)/l)
                                   lDf[is.na(lDf)] = 0
                                   apply(lDf,2,mad)
                               })
    ## Define local function detecting spikes
    get_sp = function(dataM,
                      f_length,
                      MAD,
                      site_idx=0,
                      minimalDist=15) {
        lDf = -dataM
        lDf = filter(lDf,rep(1,f_length)/f_length)
        lDf[is.na(lDf)] = 0
        lDf = t(t(lDf)/MAD)
        bellow.thrs = t(t(lDf) < thres)
        lDfr = lDf
        lDfr[bellow.thrs] = 0
        if (site_idx == 0)
            res = peaks(apply(lDfr,1,sum),minimalDist)
        else
            res = peaks(lDfr[,site_idx],minimalDist)
        res[res>before & res < dim(dataM)[1]-after]
    }
    
    out_names = c(names(centers),"?") ## Possible names for classification
    data0 = data ## The normalized version of the data
    for (r_idx in 1:n_rounds) {
        s_idx = detection_cycle[r_idx]
        if (verbose > 1 && s_idx==0)
            cat(paste("Doing now round",r_idx-1,"detecting on all sites\n"))
        if (verbose > 1 && s_idx!=0)
            cat(paste("Doing now round",r_idx-1,"detecting on site",s_idx,"\n"))
        sp = get_sp(dataM=data,
                    f_length=ifelse(r_idx==1,filter_length_1,filter_length),
                    MAD=filtered_data_mad[,ifelse(r_idx==1,1,2)],
                    site_idx=s_idx,
                    minimalDist=ifelse(r_idx==1,minimalDist_1,minimalDist))
        if (length(sp)==0) next
        new_round = lapply(as.vector(sp),classify_and_align_evt,
                           data=data,centers=centers,
                           before=before,after=after)
        pred = predict_data(new_round,centers,
                            nb_channels = n_chan,
                            data_length = n_samples)
        data = data - pred
        res = sapply(out_names,
                     function(n) sum(sapply(new_round, function(l) l[[1]] == n)))
        res = c(length(sp),res)
        names(res) = c("Total",out_names)
        if (verbose > 1) {
            print(res)
            cat("\n")
        }
        if (r_idx==1)
            round_all = new_round
        else
            round_all = c(round_all,new_round)
    }

    ## Get the global prediction
    pred = predict_data(round_all,centers,
                        nb_channels=n_chan,
                        data_length=n_samples)
    ## Get the residuals
    resid = data0 - pred
    ## Repeat inital detection on resid
    sp = get_sp(dataM=resid,
                f_length=filter_length_1,
		MAD=filtered_data_mad[,1],
                site_idx=detection_cycle[1],
                minimalDist=minimalDist_1)
    ## make events objects from this stuff
    unknown = mkEvents(sp,resid,before,after)
    ## get global counts
    res = sapply(out_names,
                 function(n) sum(sapply(round_all, function(l) l[[1]] == n)))
    res["?"] = length(sp)
    res=c(sum(res),res)
    names(res) = c("Total",out_names)
    if (verbose > 0) {
        cat("Global counts at classification's end:\n")
        print(res)
    }
    ## Get centers
    obs_nb = lapply(out_names[-length(out_names)],
                    function(cn) sum(sapply(round_all, function(l) l[[1]]==cn)))
    names(obs_nb) = out_names[-length(out_names)]
    spike_trains = lapply(out_names[-length(out_names)],
                          function(cn) {
                              if (obs_nb[cn] <= 1)
                                  return(numeric(0))
                              else
                                  res = sapply(round_all[sapply(round_all, function(l) l[[1]]==cn)],
                                               function(l)
                                                   round(l[[2]]+l[[3]]))
                              res[res>0 & res<n_samples]
                          }
                              )    
    centersN = lapply(1:length(spike_trains),
                      function(st_idx) {
                          if (length(spike_trains[[st_idx]]) == 0)
                              centers[[st_idx]]
                          else
                              mk_center_list(spike_trains[[st_idx]],data0,
                                             before=before,after=after)
                      }
                      )
    names(centersN) = out_names[-length(out_names)]
    list(prediction=pred,
         residual=resid,
         counts=res,
         unknown=unknown,
         centers=centersN,
         classification=round_all)
}
#+END_SRC

Argument =verbose= controls the level of "verbosity": if 0 nothing is printed to the =stdout=; if 1 the final results are printed; if 2 (default) the final and intermediate (following each peeling round) results are printed.

*** Test

We test the function with:

#+NAME: all_at_once-test
#+BEGIN_SRC R :results output :exports both :session *R*
## We need again an un-normalized version of the data
ref_data = rbind(cbind(h5read("locust20010214_part1.hdf5", "/Spontaneous_2/trial_30/ch02"),
                       h5read("locust20010214_part1.hdf5", "/Spontaneous_2/trial_30/ch03"),
                       h5read("locust20010214_part1.hdf5", "/Spontaneous_2/trial_30/ch05"),
                       h5read("locust20010214_part1.hdf5", "/Spontaneous_2/trial_30/ch07")))
## We can now use our function
aao=all_at_once(data=ref_data, centers, thres=threshold_factor*c(1,1,1,1), 
                filter_length_1=filter_length, filter_length=filter_length, 
                minimalDist_1=15, minimalDist=15, 
                before=c_before, after=c_after, 
                detection_cycle=c(0,0), verbose=2)
#+END_SRC

#+RESULTS: all_at_once-test
#+begin_example
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  98   Min.   : 610   Min.   : 762   Min.   : 475  
 1st Qu.:2011   1st Qu.:2015   1st Qu.:2017   1st Qu.:2014  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2105   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2102  
 Max.   :3634   Max.   :3076   Max.   :2887   Max.   :3143  

Doing now round 0 detecting on all sites
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1950        156        119         84         77        202         48 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       126        285        401        433         19 

Doing now round 1 detecting on all sites
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
       216          0          1          1          2          9          6 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
         3         44         51         78         21 

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2185        156        120         85         79        211         54 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       129        329        452        511         59
#+end_example




We see that we are getting back the numbers we obtained before step by step.

We can compare the "old" and "new" centers with (not shown):

#+NAME: all_at_once-center-comp-sterCa
#+BEGIN_SRC R :eval never 
layout(matrix(1:nbc,nr=nbc))
par(mar=c(1,4,1,1))
for (i in 1:nbc) {
    plot(centers[[i]]$center,lwd=2,col=2,
         ylim=the_range,type="l")
    abline(h=0,col="grey50")
    abline(v=(c_before+c_after)+1,col="grey50")
    lines(aao$centers[[i]]$center,lwd=1,col=4)
}
#+END_SRC

They are not exactly identical since the new version is computed with all events (superposed or not) attributed to each neuron.

* Analyzing a sequence of trials

** Create a directory were results get saved

We will carry out an analysis of sequences of 30/25 trials with a given odor. At the end of the analysis of the sequence we will save some intermediate =R= object in a directory we are now creating.:

#+NAME: create-tetB_analysis
#+BEGIN_SRC R :session *R* :results silent
if (!dir.exists("tetB_analysis"))
    dir.create("tetB_analysis")
#+END_SRC

** Create a data loading function

We want to write a function that takes a trial number and stimulus name and returns a matrix containing stereode Ca  (channels 9, 11) data for this trial. The only little trick the function must include is the fact that a number =x= smaller than 10 appears in the data set name as =0x=:

#+NAME: get_tetrode_data
#+BEGIN_SRC R :session *R* :results silent
get_tetrode_data = function(trial_idx,stim="Spontaneous_1") {
    prefix = ifelse(trial_idx<10,
                    paste0("/",stim,"/trial_0",trial_idx),
                    paste0("/",stim,"/trial_",trial_idx)
                    )
    cbind(h5read("locust20010214_part1.hdf5", paste0(prefix,"/ch02")),
          h5read("locust20010214_part1.hdf5", paste0(prefix,"/ch03")),
          h5read("locust20010214_part1.hdf5", paste0(prefix,"/ch05")),
          h5read("locust20010214_part1.hdf5", paste0(prefix,"/ch07")))
}
#+END_SRC

** =sort_many_trials= definition

We define now function =sort_many_trials=. This function takes the following formal parameters:

- *inter_trial_time*: the time (/in sample points/) between two successive trials. Example =10*15000=.
- *get_data_fct*: a function loading the data of a single trial (like =get_stereode_data= we just defined). This function should take a trial number as its first argument and a sequence name as its second. Example =get_stereode_data=.
- *stim_name*: the sequence name making the second argument of function =get_data_fct=. Example "1-Hexanol".
- *trial_nbs*: a vector containing the indices of the trials to sort. Example =1:30=.
- *centers*: a list like the =centers= list above. Example =aao$centers=.
- *counts*:  a vector with the number of counts each unit got at the previous stage. Example =aao$counts=.
- *all_at_once_call_list*: a named list with the arguments used in the previous call to all at once except the first two.
- *layout_matrix*: a matrix controlling the layout of the diagnostic plots generated while the function is running.
- *new_weight_in_update*: the maximal weight of the new template in the estimation of the current one.

The function returns a list with the following elements:

- *centers*: the last estimation of the templates.
- *counts*: the last counts.
- *centers_L*: a list of matrices. Each matrix contains the successive template for each neuron (used to track template evolution).
- *counts_M*: a matrix with the successive counts.
- *spike_trains*: a list of spike trains, one per neuron.

#+NAME: sort_many_trials
#+BEGIN_SRC R :session *R* :results silent
sort_many_trials = function(inter_trial_time,
                            get_data_fct,
                            stim_name,
                            trial_nbs,
                            centers,
                            counts,
                            all_at_once_call_list=list(thres=4*c(1,1), 
                                                       filter_length_1=5, filter_length=3, 
                                                       minimalDist_1=15, minimalDist=10, 
                                                       before=c_before, after=c_after, 
                                                       detection_cycle=c(0,0), verbose=1),
                            layout_matrix=matrix(1:10,nr=5),
                            new_weight_in_update=0.01
                            ) {
    centers_old = centers
    counts_old = counts
    counts_M = matrix(0,nr=length(trial_nbs),nc=length(counts_old))
    centers_L = lapply(centers,
                       function(c) {
                           res = matrix(0,nr=length(c$center),nc=length(trial_nbs))
                           res[,1] = c$center
                           res
                       }
                       )
    names(centers_L) = names(centers)
    nbc = length(centers)
    spike_trains = vector("list",nbc)
    names(spike_trains) = paste("Cluster",1:nbc)
    idx=1
    for (trial_idx in trial_nbs) {
        ref_data = get_data_fct(trial_idx,stim_name)
        cat(paste0("***************\nDoing now trial ",trial_idx," of ",stim_name,"\n"))
        analysis = do.call(all_at_once,
                           c(list(data=ref_data,centers=centers),all_at_once_call_list))
        cat(paste0("Trial ",trial_idx," done!\n******************\n"))
        centers_new = analysis$centers
        counts_new = analysis$counts
        counts_M[idx,] = counts_new
        centers = centers_new
        for (c_idx in 1:length(centers)){
            n = counts_new[c_idx+1]
            o = counts_old[c_idx+1]
            w = new_weight_in_update*ifelse(o>0,min(1,n/o),0) ## New template weight
            centers[[c_idx]]$center=w*centers_new[[c_idx]]$center+(1-w)*centers_old[[c_idx]]$center
            centers[[c_idx]]$centerD=w*centers_new[[c_idx]]$centerD+(1-w)*centers_old[[c_idx]]$centerD
            centers[[c_idx]]$centerDD=w*centers_new[[c_idx]]$centerDD+(1-w)*centers_old[[c_idx]]$centerDD
            centers[[c_idx]]$centerD_norm2=sum(centers[[c_idx]]$centerD^2)
            centers[[c_idx]]$centerDD_norm2=sum(centers[[c_idx]]$centerDD^2)
            centers[[c_idx]]$centerD_dot_centerDD=sum(centers[[c_idx]]$centerD*centers[[c_idx]]$centerDD)
            centers_L[[c_idx]][,idx] = centers[[c_idx]]$center
        }
        layout(layout_matrix)
        par(mar=c(1,3,3,1))
        the_pch = if (nbc<10) c(paste(1:nbc),"?")
                  else c(paste(1:9),letters[1:(nbc-9)],"?")
        matplot(counts_M[,2:length(counts_old)],type="b",
                pch=the_pch)
        c_range = range(sapply(centers_L,
                               function(m) range(m[,1:idx])))
        for (i in 1:nbc) {
            if (idx<3)
                matplot(centers_L[[i]][,1:idx],type="l",col=1,lty=1,lwd=0.5,
                        main=paste("Unit",i),ylim=c_range)
            else
                matplot(centers_L[[i]][,1:idx],type="l",col=c(4,rep(1,idx-2),2),
                        lty=1,lwd=0.5,main=paste("Unit",i),ylim=c_range)
        }
        centers_old = centers
        counts_old = counts_new
        round_all = analysis$classification
        st = lapply(paste("Cluster",1:nbc),
                    function(cn) sapply(round_all[sapply(round_all,
                                                         function(l) l[[1]]==cn)],
                                        function(l) l[[2]]+l[[3]]))
        names(st) = paste("Cluster",1:nbc)
        for (cn in paste("Cluster",1:nbc)) {
            if (length(st[[cn]]) > 0)
                spike_trains[[cn]] = c(spike_trains[[cn]],
                (trial_idx-1)*inter_trial_time + sort(st[[cn]]))
        }
        idx = idx+1
    }
    spike_trains = lapply(spike_trains,sort)
    list(centers=centers,
         counts=counts_new,
         spike_trains=spike_trains,
         counts_M=counts_M,
         centers_L=centers_L,
         trial_nbs=trial_nbs,
	 call=match.call())
}          
#+END_SRC

** Diagnostic plot function definitions

We define next three functions defining diagnostic plots at the end of a sequence analysis:

#+NAME: counts_evolution
#+BEGIN_SRC R :session *R* :results silent
counts_evolution = function(smt_res ## result of a sort_many_trials call
                           ) {
    nbc = length(smt_res$centers)
    the_pch = if (nbc<10) c(paste(1:nbc),"?")
                  else c(paste(1:9),letters[1:(nbc-9)],"?")
    matplot(smt_res$trial_nbs,
            smt_res$counts_M[,2:(nbc+2)],
            type="b",pch=the_pch,
            main="Counts evolution",xlab="Trial index",ylab="Number of events")
}
#+END_SRC

#+NAME: waveform_evolution
#+BEGIN_SRC R :session *R* :results silent
waveform_evolution = function(smt_res, ## result of a sort_many_trials call
                              threshold_factor=4, ## threshold used
                              layout_matrix=matrix(1:nbc,nr=nbc)
                              ) {
    nbc = length(smt_res$centers)
    nt = length(smt_res$trial_nbs)
    layout(layout_matrix)
    par(mar=c(1,3,4,1))
    for (i in 1:nbc) {
        matplot(smt_res$centers_L[[i]],
                type="l",col=c(4,rep(1,nt-2),2),lty=1,lwd=0.5,
                main=paste("Unit",i),ylab="")
        abline(h=-threshold_factor,col="grey")
        }
}
#+END_SRC

#+NAME: cp_isi
#+BEGIN_SRC R :session *R* :results silent
cp_isi=function(smt_res, ## result of a sort_many_trials call
                inter_trial_time=10, ## time between trials in seconds
                sampling_rate=15000, ## sampling rate in Hz
                nbins=50, ## number of bins for isi histogram
                isi_max=1, ## largest isi in isi histogram
                layout_matrix=matrix(1:(2*still_there),nr=still_there,byrow=TRUE)
                ) {
    t_duration = inter_trial_time
    n_trials = length(smt_res$trial_nbs)
    nbc = length(smt_res$centers)
    still_there = nbc - sum(sapply(smt_res$spike_trains,
                                   function(l)
                                       is.null(l) || length(l) <= n_trials))
    layout(layout_matrix)
    par(mar=c(4,4,4,1))
    for (cn in names(smt_res$spike_trains)) {
        if (is.null(smt_res$spike_trains[[cn]]) || length(smt_res$spike_trains[[cn]]) <= n_trials) next
        st = smt_res$spike_trains[[cn]]/sampling_rate
        plot(st,1:length(st),
             main=paste("Observed CP for unit",cn),
             xlab="Time (s)",ylab="Nb of evts",type="s")
        isi = diff(st)
        isi = isi[isi <= isi_max]
        hist(isi,breaks=nbins,
             prob=TRUE,xlim=c(0,0.5),
             main=paste("ISI dist for unit",cn),
             xlab="Interval (s)",ylab="Density (1/s)")
    } 
}
#+END_SRC

#+NAME: cp_isi_raster
#+BEGIN_SRC R :session *R* :results silent
cp_isi_raster=function(smt_res, ## result of a sort_many_trials call
                      inter_trial_time=10, ## time between trials in seconds
                      sampling_rate=15000, ## sampling rate in Hz
                      nbins=50, ## number of bins for isi histogram
                      isi_max=1, ## largest isi in isi histogram
                      layout_matrix=matrix(1:(3*still_there),nr=still_there,byrow=TRUE)
                      ) {
    t_duration = inter_trial_time
    n_trials = length(smt_res$trial_nbs)
    nbc = length(smt_res$centers)
    still_there = nbc - sum(sapply(smt_res$spike_trains,
                                   function(l)
                                       is.null(l) || length(l) <= n_trials))
    layout(layout_matrix)
    par(mar=c(4,4,4,1))
    for (cn in names(smt_res$spike_trains)) {
        if (is.null(smt_res$spike_trains[[cn]]) || length(smt_res$spike_trains[[cn]]) <= n_trials) next
        st = smt_res$spike_trains[[cn]]/sampling_rate
        plot(st,1:length(st),
             main=paste("Observed CP for unit",cn),
             xlab="Time (s)",ylab="Nb of evts",type="s")
        isi = diff(st)
        isi = isi[isi <= isi_max]
        hist(isi,breaks=nbins,
             prob=TRUE,xlim=c(0,0.5),
             main=paste("ISI dist for unit",cn),
             xlab="Interval (s)",ylab="Density (1/s)")
        plot(c(0,t_duration),c(0,n_trials+1),type="n",axes=FALSE,
             xlab="",ylab="",main=paste("Raster of unit",cn))
        for (t_idx in 1:n_trials) {
            sub_st = st[(t_idx-1)*t_duration <= st &
                        st < t_idx*t_duration] - (t_idx-1)*t_duration
            if (length(sub_st) > 0)
                points(sub_st, rep(t_idx,length(sub_st)), pch=".")
        }
    } 
}
#+END_SRC

* Systematic analysis of the 30 trials from =Spontaneous_2= backwards

We will carry out an analysis of the 30 trials of =Spontaenous_2= /backwards/ since the model was estimated from the last trial. The =LabBook= mentions that that noise is present at trials 23, 24 and 25 so we skip these trials.


** Doing the job

#+NAME: Spontaneous_2-tetB
#+BEGIN_SRC R :exports both :results output :session *R*
a_Spontaneous_2_tetB=sort_many_trials(inter_trial_time=30*15000,
                                      get_data_fct=get_tetrode_data,
                                      stim_name="Spontaneous_2",
                                      trial_nbs=rev(c(1:22,26:30)),
                                      centers=aao$centers,
                                      counts=aao$counts,
                                      all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                                 filter_length_1=filter_length, filter_length=filter_length, 
                                                                 minimalDist_1=15, minimalDist=15, 
                                                                 before=c_before, after=c_after, 
                                                                 detection_cycle=c(0,0), verbose=1),
                                      layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                                      )
#+END_SRC




** Diagnostic plots

The counts evolution is:

#+NAME: Spontaneous_2-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file Spontaneous_2-count-evolution-tetB.png
#+BEGIN_SRC R :exports both :results output graphics :session *R*
counts_evolution(a_Spontaneous_2_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 30 trials of =Spontaneous_2= for tetrode B.
#+RESULTS: Spontaneous_2-count-evolution-tetB
[[file:locust20010214_tetB_fig/Spontaneous_2-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: Spontaneous_2-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file Spontaneous_2-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports both :results output graphics :session *R*
waveform_evolution(a_Spontaneous_2_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 30 trials with =Spontaneous_2= for tetrode B.
#+RESULTS: Spontaneous_2-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/Spontaneous_2-waveform-evolution-tetB.png]]

The observed counting processes and inter spike intervals densities are:

#+NAME: Spontaneous_2-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file Spontaneous_2-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports both :results output graphics :session *R*
cp_isi(a_Spontaneous_2_tetB,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for Spontaneous_1.
#+RESULTS: Spontaneous_2-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/Spontaneous_2-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 6 units:

#+NAME: Spontaneous_2-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file Spontaneous_2-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_Spontaneous_2_tetB$spike_trains[[i]],
                    a_Spontaneous_2_tetB$spike_trains[[j]],
		    nbins=200, single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaneous_2. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: Spontaneous_2-rt-test-tetB
[[file:locust20010214_tetB_fig/Spontaneous_2-rt-test-tetB.png]]

Still no clear signs of interactions.

** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-Spontaneous_2
#+BEGIN_SRC R :session *R* :results silent
save(a_Spontaneous_2_tetB,
     file=paste0("tetB_analysis/tetB_","Spontaneous_2","_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_Spontaneous_2_tetB$spike_trains))
    cat(a_Spontaneous_2_tetB$spike_trains[[c_idx]],
        file=paste0("locust20010214_spike_trains/locust20010214_Spontaneous_2_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC

* 30 trials of =Spontaenous_1= backwards

We will carry out an analysis of the 30 trials of =Spontaneous_2= /backwards/. The =LabBook= mentions that that noise is present at trials 11 and 21 so we skip these trials.

** Do the job

#+NAME: Spontaneous_1-tetB
#+BEGIN_SRC R :exports both :results output :session *R*
a_Spontaneous_1_tetB=sort_many_trials(inter_trial_time=30*15000,
                                      get_data_fct=get_tetrode_data,
                                      stim_name="Spontaneous_1",
                                      trial_nbs=rev(c(1:10,12:20,22:30)),
                                      centers=a_Spontaneous_2_tetB$centers,
                                      counts=a_Spontaneous_2_tetB$counts,
                                      all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                                 filter_length_1=filter_length, filter_length=filter_length, 
                                                                 minimalDist_1=15, minimalDist=15, 
                                                                 before=c_before, after=c_after, 
                                                                 detection_cycle=c(0,0), verbose=1),
                                      layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                                      )
#+END_SRC

#+RESULTS: Spontaneous_1-tetB
#+begin_example
***************
Doing now trial 30 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 394   Min.   : 741   Min.   :1073   Min.   : 737  
 1st Qu.:2013   1st Qu.:2015   1st Qu.:2017   1st Qu.:2015  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2095   3rd Qu.:2101  
 Max.   :3212   Max.   :2986   Max.   :2984   Max.   :3085  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1930        145        147         62         68        186         23 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       113        244        411        401        130 
Trial 30 done!
******************
***************
Doing now trial 29 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 343   Min.   : 530   Min.   : 749   Min.   : 821  
 1st Qu.:2013   1st Qu.:2016   1st Qu.:2017   1st Qu.:2015  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2095   3rd Qu.:2101  
 Max.   :3292   Max.   :3109   Max.   :2958   Max.   :3077  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1790        100        182         61         69        192         32 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       130        214        342        368        100 
Trial 29 done!
******************
***************
Doing now trial 28 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 382   Min.   : 739   Min.   :1006   Min.   : 359  
 1st Qu.:2013   1st Qu.:2016   1st Qu.:2018   1st Qu.:2015  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2101  
 Max.   :3197   Max.   :3089   Max.   :2865   Max.   :3317  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1819        118        153         52         78        205         31 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       186        239        303        353        101 
Trial 28 done!
******************
***************
Doing now trial 27 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 412   Min.   : 671   Min.   : 888   Min.   : 483  
 1st Qu.:2013   1st Qu.:2016   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3267   Max.   :3011   Max.   :2821   Max.   :3266  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1718        126        115         58         56        200         46 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       136        238        312        331        100 
Trial 27 done!
******************
***************
Doing now trial 26 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 369   Min.   : 566   Min.   : 900   Min.   : 855  
 1st Qu.:2012   1st Qu.:2015   1st Qu.:2017   1st Qu.:2015  
 Median :2058   Median :2057   Median :2056   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2094   3rd Qu.:2101  
 Max.   :3242   Max.   :3101   Max.   :2916   Max.   :3095  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1923        128        128         61        118        227         55 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       152        260        359        318        117 
Trial 26 done!
******************
***************
Doing now trial 25 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 587   Min.   : 877   Min.   :1091   Min.   : 743  
 1st Qu.:2013   1st Qu.:2016   1st Qu.:2017   1st Qu.:2015  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2103   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2101  
 Max.   :3188   Max.   :2939   Max.   :2733   Max.   :3093  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1767        127        138         57         80        221         27 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       159        243        310        313         92 
Trial 25 done!
******************
***************
Doing now trial 24 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 492   Min.   : 702   Min.   :1130   Min.   : 596  
 1st Qu.:2013   1st Qu.:2017   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3233   Max.   :3007   Max.   :2723   Max.   :3095  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1738         91        110         75         68        182         29 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       171        261        333        337         81 
Trial 24 done!
******************
***************
Doing now trial 23 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 362   Min.   : 736   Min.   :1065   Min.   : 430  
 1st Qu.:2013   1st Qu.:2016   1st Qu.:2018   1st Qu.:2015  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3241   Max.   :3003   Max.   :2790   Max.   :3203  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1746        103        114         85         75        172         28 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       151        223        409        314         72 
Trial 23 done!
******************
***************
Doing now trial 22 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 517   Min.   : 779   Min.   :1170   Min.   : 759  
 1st Qu.:2013   1st Qu.:2016   1st Qu.:2017   1st Qu.:2015  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3290   Max.   :3095   Max.   :2769   Max.   :3131  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1744        139        104         34        100        238         29 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       122        276        346        283         73 
Trial 22 done!
******************
***************
Doing now trial 20 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 552   Min.   : 792   Min.   : 970   Min.   : 830  
 1st Qu.:2013   1st Qu.:2016   1st Qu.:2017   1st Qu.:2016  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3186   Max.   :2980   Max.   :2858   Max.   :3093  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1851        133        138         73         47        175         44 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       117        329        390        269        136 
Trial 20 done!
******************
***************
Doing now trial 19 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 473   Min.   : 656   Min.   : 869   Min.   : 864  
 1st Qu.:2013   1st Qu.:2015   1st Qu.:2017   1st Qu.:2015  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2095   3rd Qu.:2101  
 Max.   :3273   Max.   :3158   Max.   :2926   Max.   :3241  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1859        149        140         17        104        275         30 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       120        243        332        284        165 
Trial 19 done!
******************
***************
Doing now trial 18 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 518   Min.   : 781   Min.   :1089   Min.   : 377  
 1st Qu.:2013   1st Qu.:2015   1st Qu.:2017   1st Qu.:2015  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2095   3rd Qu.:2101  
 Max.   :3261   Max.   :3000   Max.   :2751   Max.   :3275  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1835        129        148         38         58        246         57 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       194        255        330        239        141 
Trial 18 done!
******************
***************
Doing now trial 17 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 691   Min.   : 813   Min.   :1043   Min.   : 865  
 1st Qu.:2014   1st Qu.:2016   1st Qu.:2017   1st Qu.:2015  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3154   Max.   :2910   Max.   :2679   Max.   :3093  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1728        129        133         30         48        210         41 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       140        263        356        268        110 
Trial 17 done!
******************
***************
Doing now trial 16 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 545   Min.   : 990   Min.   :1203   Min.   : 663  
 1st Qu.:2014   1st Qu.:2016   1st Qu.:2017   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3104   Max.   :2898   Max.   :2648   Max.   :3121  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1688        113        139         33         59        207         42 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       163        206        366        246        114 
Trial 16 done!
******************
***************
Doing now trial 15 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 644   Min.   : 986   Min.   :1138   Min.   : 754  
 1st Qu.:2013   1st Qu.:2016   1st Qu.:2017   1st Qu.:2015  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3180   Max.   :3002   Max.   :2687   Max.   :3088  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1724        119        130         39         55        200         25 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       141        237        387        275        116 
Trial 15 done!
******************
***************
Doing now trial 14 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 541   Min.   : 778   Min.   : 975   Min.   : 882  
 1st Qu.:2014   1st Qu.:2016   1st Qu.:2018   1st Qu.:2015  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3174   Max.   :3040   Max.   :2734   Max.   :3133  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1730        110        130         53         51        180         30 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       140        264        398        269        105 
Trial 14 done!
******************
***************
Doing now trial 13 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 531   Min.   : 815   Min.   :1188   Min.   : 797  
 1st Qu.:2013   1st Qu.:2017   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3179   Max.   :2946   Max.   :2670   Max.   :3213  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1760        104        124         33         85        202         35 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       192        222        383        264        116 
Trial 13 done!
******************
***************
Doing now trial 12 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 490   Min.   : 771   Min.   : 975   Min.   : 647  
 1st Qu.:2013   1st Qu.:2016   1st Qu.:2018   1st Qu.:2015  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2101  
 Max.   :3396   Max.   :3005   Max.   :2709   Max.   :3251  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1867        161        122         45        119        203         27 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        270        325        322        119 
Trial 12 done!
******************
***************
Doing now trial 10 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 721   Min.   : 993   Min.   :1250   Min.   : 808  
 1st Qu.:2014   1st Qu.:2017   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2093   3rd Qu.:2099  
 Max.   :3103   Max.   :2868   Max.   :2631   Max.   :3095  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1765         88        124         35         34        125         29 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       134        333        341        327        195 
Trial 10 done!
******************
***************
Doing now trial 9 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 637   Min.   : 921   Min.   : 976   Min.   : 315  
 1st Qu.:2014   1st Qu.:2016   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :4071   Max.   :4071   Max.   :4074   Max.   :4074  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1926        154        129         60         50        153         34 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       133        309        303        361        240 
Trial 9 done!
******************
***************
Doing now trial 8 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 552   Min.   : 789   Min.   : 977   Min.   : 690  
 1st Qu.:2014   1st Qu.:2017   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2094   3rd Qu.:2099  
 Max.   :3106   Max.   :2880   Max.   :2813   Max.   :3236  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1720        113        104         40         68        140         22 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       155        257        319        336        166 
Trial 8 done!
******************
***************
Doing now trial 7 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 492   Min.   : 957   Min.   :1112   Min.   : 587  
 1st Qu.:2014   1st Qu.:2016   1st Qu.:2018   1st Qu.:2015  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3367   Max.   :3004   Max.   :2744   Max.   :3156  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1835        116        145         47         47        158         31 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       149        298        316        345        183 
Trial 7 done!
******************
***************
Doing now trial 6 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 672   Min.   :1002   Min.   :1264   Min.   : 763  
 1st Qu.:2014   1st Qu.:2016   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2094   3rd Qu.:2099  
 Max.   :3060   Max.   :2879   Max.   :2704   Max.   :3255  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1810        106        100         52         65        116         37 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       129        282        328        412        183 
Trial 6 done!
******************
***************
Doing now trial 5 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 600   Min.   : 801   Min.   :1080   Min.   : 738  
 1st Qu.:2015   1st Qu.:2017   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2093   3rd Qu.:2099  
 Max.   :3162   Max.   :2985   Max.   :2854   Max.   :3103  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1701        107         88         43         64        100         34 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       142        327        323        308        165 
Trial 5 done!
******************
***************
Doing now trial 4 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 712   Min.   : 971   Min.   :1088   Min.   : 763  
 1st Qu.:2014   1st Qu.:2017   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2094   3rd Qu.:2100  
 Max.   :3196   Max.   :2883   Max.   :2740   Max.   :3245  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1795        128        137         66         65         99         20 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       138        273        376        308        185 
Trial 4 done!
******************
***************
Doing now trial 3 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 726   Min.   : 985   Min.   :1354   Min.   : 829  
 1st Qu.:2014   1st Qu.:2017   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2094   3rd Qu.:2099  
 Max.   :3118   Max.   :2873   Max.   :2659   Max.   :3056  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1801         99        152         38         67        101         24 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       163        303        383        313        158 
Trial 3 done!
******************
***************
Doing now trial 2 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 699   Min.   : 972   Min.   :1209   Min.   : 466  
 1st Qu.:2014   1st Qu.:2017   1st Qu.:2018   1st Qu.:2016  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2056   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2094   3rd Qu.:2099  
 Max.   :3178   Max.   :2922   Max.   :2651   Max.   :3164  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1718        102        103         48         54         88         44 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       178        287        383        315        116 
Trial 2 done!
******************
***************
Doing now trial 1 of Spontaneous_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 566   Min.   : 890   Min.   :1158   Min.   : 758  
 1st Qu.:2014   1st Qu.:2016   1st Qu.:2017   1st Qu.:2015  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2055   Mean   :2055   Mean   :2055   Mean   :2056  
 3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2094   3rd Qu.:2099  
 Max.   :3159   Max.   :2914   Max.   :2696   Max.   :3179  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      1807         94        125         32         66        139         31 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       181        280        387        350        122 
Trial 1 done!
******************
#+end_example


** Diagnostic plots

The counts evolution is:

#+NAME: Spontaneous_1-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file Spontaneous_1-count-evolution-tetB.png
#+BEGIN_SRC R :exports both :results output graphics :session *R*
counts_evolution(a_Spontaneous_1_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9and "a") or unclassified ("?") during the 30 trials of =Spontaneous_1= for tetrode B.
#+RESULTS: Spontaneous_1-count-evolution-tetB
[[file:locust20010214_tetB_fig/Spontaneous_1-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: Spontaneous_1-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file Spontaneous_1-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports both :results output graphics :session *R*
waveform_evolution(a_Spontaneous_1_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 30-2 trials of =Spontaneous_1= for tetrode B.
#+RESULTS: Spontaneous_1-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/Spontaneous_1-waveform-evolution-tetB.png]]

The observed counting processes and inter spike intervals densities are:

#+NAME: Spontaneous_1-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file Spontaneous_1-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports both :results output graphics :session *R*
cp_isi(a_Spontaneous_1_tetB,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes and empirical inter spike interval distributions for Spontaneous_1.
#+RESULTS: Spontaneous_1-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/Spontaneous_1-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: Spontaneous_1-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file Spontaneous_1-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_Spontaneous_1_tetB$spike_trains[[i]],
                    a_Spontaneous_1_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: Spontaneous_1-rt-test-tetB
[[file:locust20010214_tetB_fig/Spontaneous_1-rt-test-tetB.png]]

** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-Spontaneous_1
#+BEGIN_SRC R :session *R* :results silent
save(a_Spontaneous_1_tetB,
     file=paste0("tetB_analysis/tetB_","Spontaneous_1","_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_Spontaneous_1_tetB$spike_trains))
    cat(a_Spontaneous_1_tetB$spike_trains[[c_idx]],
        file=paste0("locust20010214_spike_trains/locust20010214_Spontaneous_1_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC

* 25 trials with =Cis-3-Hexen-1-ol= (=C3H_1=)

We will carry out an analysis of the 25 trials from =C3H_1=.   

** Do the job

We do not print out the output to save space.

#+NAME: C3H_1-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
a_C3H_1_tetB=sort_many_trials(inter_trial_time=30*15000,
                              get_data_fct=get_tetrode_data,
                              stim_name="C3H_1",
                              trial_nbs=1:25,
                              centers=aao$centers,
                              counts=aao$counts,
                              all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                         filter_length_1=filter_length, filter_length=filter_length, 
                                                         minimalDist_1=15, minimalDist=15, 
                                                         before=c_before, after=c_after, 
                                                         detection_cycle=c(0,0), verbose=1),
                              layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                              )
#+END_SRC

#+RESULTS: C3H_1-tetB
#+begin_example
***************
Doing now trial 1 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  38   Min.   : 507   Min.   : 898   Min.   : 623  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3573   Max.   :3087   Max.   :2901   Max.   :3140  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2416        241        123         89         69        259         39 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       136        321        401        643         95 
Trial 1 done!
******************
***************
Doing now trial 2 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 320   Min.   : 434   Min.   : 723   Min.   : 774  
 1st Qu.:2010   1st Qu.:2015   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3252   Max.   :3239   Max.   :3075   Max.   :2931  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2247        187        171         63         76        237         30 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       172        269        318        638         86 
Trial 2 done!
******************
***************
Doing now trial 3 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 366   Min.   : 676   Min.   : 979   Min.   : 480  
 1st Qu.:2011   1st Qu.:2015   1st Qu.:2017   1st Qu.:2014  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2105   3rd Qu.:2098   3rd Qu.:2095   3rd Qu.:2102  
 Max.   :3314   Max.   :3145   Max.   :2891   Max.   :3146  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2095        156        122         51        111        181         38 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       156        271        358        584         67 
Trial 3 done!
******************
***************
Doing now trial 4 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 458   Min.   : 546   Min.   : 718   Min.   : 814  
 1st Qu.:2011   1st Qu.:2015   1st Qu.:2017   1st Qu.:2014  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3392   Max.   :3168   Max.   :2850   Max.   :3019  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2215        154        155         61         97        270         41 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       153        256        311        611        106 
Trial 4 done!
******************
***************
Doing now trial 5 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 308   Min.   : 393   Min.   : 668   Min.   : 612  
 1st Qu.:2011   1st Qu.:2015   1st Qu.:2017   1st Qu.:2014  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3320   Max.   :3236   Max.   :2961   Max.   :2996  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2177        156        154         31         77        242         43 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       158        293        291        642         90 
Trial 5 done!
******************
***************
Doing now trial 6 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 375   Min.   : 469   Min.   :1163   Min.   : 945  
 1st Qu.:2011   1st Qu.:2015   1st Qu.:2017   1st Qu.:2014  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2105   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3200   Max.   :3056   Max.   :2888   Max.   :3007  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2135        113        141         44        112        245         42 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       172        197        390        605         74 
Trial 6 done!
******************
***************
Doing now trial 7 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  74   Min.   : 455   Min.   :1006   Min.   : 899  
 1st Qu.:2011   1st Qu.:2015   1st Qu.:2017   1st Qu.:2014  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3545   Max.   :3194   Max.   :2856   Max.   :2905  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2209        153        146         45         88        256         43 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       143        241        334        655        105 
Trial 7 done!
******************
***************
Doing now trial 8 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 132   Min.   : 451   Min.   : 864   Min.   : 873  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3590   Max.   :3118   Max.   :2830   Max.   :2877  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2304        155        140         29        121        315         25 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       130        286        380        638         85 
Trial 8 done!
******************
***************
Doing now trial 9 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 409   Min.   :1124   Min.   : 852  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3552   Max.   :3112   Max.   :2803   Max.   :3030  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2317        148        163         54         86        278         41 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       147        363        281        661         95 
Trial 9 done!
******************
***************
Doing now trial 10 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 253   Min.   : 564   Min.   : 999   Min.   : 698  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3281   Max.   :3119   Max.   :2806   Max.   :3216  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2403        154        148         53        108        303         42 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       172        321        353        644        105 
Trial 10 done!
******************
***************
Doing now trial 11 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 132   Min.   : 288   Min.   :1136   Min.   : 825  
 1st Qu.:2011   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3527   Max.   :3252   Max.   :2833   Max.   :2913  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2334        128        170         33         99        217         31 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       147        292        445        697         75 
Trial 11 done!
******************
***************
Doing now trial 12 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 476   Min.   : 539   Min.   :1115   Min.   : 927  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3316   Max.   :3169   Max.   :3008   Max.   :3054  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2383        105        149         52         95        308         35 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       185        307        363        689         95 
Trial 12 done!
******************
***************
Doing now trial 13 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 149   Min.   : 267   Min.   : 595   Min.   : 535  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3368   Max.   :3218   Max.   :3061   Max.   :3141  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2398        124        127         63        126        230         44 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       179        361        341        703        100 
Trial 13 done!
******************
***************
Doing now trial 14 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 199   Min.   : 513   Min.   :1049   Min.   : 854  
 1st Qu.:2009   1st Qu.:2014   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3402   Max.   :3251   Max.   :2797   Max.   :2917  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2790        186        146         66        114        345         30 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       173        390        480        744        116 
Trial 14 done!
******************
***************
Doing now trial 15 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 122   Min.   : 412   Min.   : 885   Min.   : 960  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3403   Max.   :3109   Max.   :2756   Max.   :2941  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2718        156        153         74         87        254         38 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        317        497        789        192 
Trial 15 done!
******************
***************
Doing now trial 16 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 390   Min.   : 542   Min.   : 844   Min.   : 823  
 1st Qu.:2011   1st Qu.:2015   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3180   Max.   :3097   Max.   :2784   Max.   :3092  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2577         89        145         39         99        197         23 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       198        244        583        817        143 
Trial 16 done!
******************
***************
Doing now trial 17 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 161   Min.   : 349   Min.   :1100   Min.   : 834  
 1st Qu.:2011   1st Qu.:2015   1st Qu.:2017   1st Qu.:2014  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2099   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3270   Max.   :3210   Max.   :2776   Max.   :3028  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2628        104        123         65         66        287         42 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       160        280        504        825        172 
Trial 17 done!
******************
***************
Doing now trial 18 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 511   Min.   : 667   Min.   :1169   Min.   :1032  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2014  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3166   Max.   :3049   Max.   :2725   Max.   :2856  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2568         94        132         57        130        264         40 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       179        310        461        793        108 
Trial 18 done!
******************
***************
Doing now trial 19 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 241   Min.   : 599   Min.   : 828   Min.   : 870  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2104  
 Max.   :3303   Max.   :3135   Max.   :2817   Max.   :2977  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2555        161        162         45        141        260         46 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       163        346        324        786        121 
Trial 19 done!
******************
***************
Doing now trial 20 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 332   Min.   : 483   Min.   :1132   Min.   : 962  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3178   Max.   :3158   Max.   :2757   Max.   :2920  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2534        123        139         44         86        208         38 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       164        376        446        765        145 
Trial 20 done!
******************
***************
Doing now trial 21 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 222   Min.   : 953   Min.   : 746  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3266   Max.   :3301   Max.   :2734   Max.   :2977  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2783        164        164         56         97        309         37 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       178        303        456        826        193 
Trial 21 done!
******************
***************
Doing now trial 22 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  25   Min.   : 683   Min.   : 967   Min.   : 731  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3623   Max.   :3147   Max.   :2849   Max.   :2922  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2998        171        160         70        119        326         44 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       205        369        486        806        242 
Trial 22 done!
******************
***************
Doing now trial 23 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 303   Min.   : 724   Min.   : 842   Min.   : 571  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3329   Max.   :3178   Max.   :2957   Max.   :3045  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2662        118        159         99        140        233         80 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       164        311        476        722        160 
Trial 23 done!
******************
***************
Doing now trial 24 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 436   Min.   : 826   Min.   : 608  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3782   Max.   :3265   Max.   :2810   Max.   :3047  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2585        143        138         79         93        253         52 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        319        435        760        159 
Trial 24 done!
******************
***************
Doing now trial 25 of C3H_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 490   Min.   : 584   Min.   : 921   Min.   : 906  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3178   Max.   :3059   Max.   :2794   Max.   :2918  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2477         97        137         56        155        211         58 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       155        249        433        775        151 
Trial 25 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: C3H_1-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file C3H_1-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_C3H_1_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 30 trials of =C3H_1= for tetrode B.
#+RESULTS: C3H_1-count-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_1-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: C3H_1-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file C3H_1-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports resutls :results output graphics :session *R*
waveform_evolution(a_C3H_1_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 25 trials of =C3H_1= for stereode Ca.
#+RESULTS: C3H_1-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_1-waveform-evolution-tetB.png]]

The observed counting processes, inter spike intervals densities and raster plots are:

#+NAME: C3H_1-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file C3H_1-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi_raster(a_C3H_1_tetB,inter_trial_time=30,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for C3H_1.
#+RESULTS: C3H_1-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/C3H_1-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: C3H_1-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file C3H_1-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_C3H_1_tetB$spike_trains[[i]],
                    a_C3H_1_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: C3H_1-rt-test-tetB
[[file:locust20010214_tetB_fig/C3H_1-rt-test-tetB.png]]

** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-C3H_1
#+BEGIN_SRC R :session *R* :results silent
save(a_C3H_1_tetB,
     file=paste0("tetB_analysis/tetB_","C3H_1","_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_C3H_1_tetB$spike_trains))
    if (!is.null(a_C3H_1_tetB$spike_trains[[c_idx]]))
        cat(a_C3H_1_tetB$spike_trains[[c_idx]],
	    file=paste0("locust20010214_spike_trains/locust20010214_C3H_1_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC

* 25 trials with =Citral=

We will carry out an analysis of the 25 trials from =Citral_1=. 
** Do the job

#+NAME: Citral_1-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "Citral_1"
a_Citral_1_tetB=sort_many_trials(inter_trial_time=30*15000,
                                 get_data_fct=get_tetrode_data,
                                 stim_name=stim_name,
                                 trial_nbs=1:25,
                                 centers=a_C3H_1_tetB$centers,
                                 counts=a_C3H_1_tetB$counts,
                                 all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                            filter_length_1=filter_length, filter_length=filter_length, 
                                                            minimalDist_1=15, minimalDist=15, 
                                                            before=c_before, after=c_after, 
                                                            detection_cycle=c(0,0), verbose=1),
                                 layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                                 )
#+END_SRC

#+RESULTS: Citral_1-tetB
#+begin_example
***************
Doing now trial 1 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 639   Min.   : 771   Min.   :1160   Min.   : 901  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3371   Max.   :3043   Max.   :2725   Max.   :2955  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2532        115         70         61        105        195         48 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       196        258        501        797        186 
Trial 1 done!
******************
***************
Doing now trial 2 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 549   Min.   : 681   Min.   :1150   Min.   :1132  
 1st Qu.:2011   1st Qu.:2015   1st Qu.:2017   1st Qu.:2014  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2105   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2102  
 Max.   :3256   Max.   :3140   Max.   :2692   Max.   :2960  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2412        124        100         52         66        196         43 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       205        249        425        809        143 
Trial 2 done!
******************
***************
Doing now trial 3 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 388   Min.   : 777   Min.   :1088   Min.   : 737  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3305   Max.   :3083   Max.   :2792   Max.   :2854  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2633        149         76         75         67        216         68 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       197        352        532        739        162 
Trial 3 done!
******************
***************
Doing now trial 4 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 271   Min.   : 363   Min.   :1084   Min.   : 805  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3516   Max.   :3282   Max.   :2706   Max.   :3065  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2368        129        115         46         87        232         49 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       176        265        401        768        100 
Trial 4 done!
******************
***************
Doing now trial 5 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 418   Min.   : 583   Min.   : 915   Min.   :1041  
 1st Qu.:2011   1st Qu.:2014   1st Qu.:2017   1st Qu.:2014  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2105   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2102  
 Max.   :3433   Max.   :3031   Max.   :2725   Max.   :2895  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2169        111        123         40         99        187         59 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       152        203        357        754         84 
Trial 5 done!
******************
***************
Doing now trial 6 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 369   Min.   : 484   Min.   : 869   Min.   : 888  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3317   Max.   :3132   Max.   :2729   Max.   :2894  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2351        121        110         74        102        209         44 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       129        265        401        781        115 
Trial 6 done!
******************
***************
Doing now trial 7 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  48   Min.   : 718   Min.   :1140   Min.   :1021  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3631   Max.   :3129   Max.   :2671   Max.   :2816  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2367        137         95         50        132        201         37 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       170        247        413        781        104 
Trial 7 done!
******************
***************
Doing now trial 8 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 392   Min.   : 635   Min.   :1071   Min.   : 707  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3175   Max.   :3113   Max.   :2749   Max.   :2905  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2499        123         83         63        110        269         80 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       186        308        403        754        120 
Trial 8 done!
******************
***************
Doing now trial 9 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 406   Min.   : 569   Min.   : 927   Min.   : 929  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3302   Max.   :3166   Max.   :2823   Max.   :2891  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2527        176        117         74         67        251         39 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       186        349        396        785         87 
Trial 9 done!
******************
***************
Doing now trial 10 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 132   Min.   : 682   Min.   :1211   Min.   :1002  
 1st Qu.:2009   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3418   Max.   :3077   Max.   :2706   Max.   :2838  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2442        118        112         30         97        225         20 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       201        309        449        785         96 
Trial 10 done!
******************
***************
Doing now trial 11 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   :   0   Min.   : 598   Min.   : 702  
 1st Qu.:2008   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :4073   Max.   :4073   Max.   :4073   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2736        166        131         71        124        300         39 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       196        389        344        848        128 
Trial 11 done!
******************
***************
Doing now trial 12 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  82   Min.   : 565   Min.   :1141   Min.   : 906  
 1st Qu.:2008   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3526   Max.   :3023   Max.   :2921   Max.   :3103  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2987        204        131         44        104        251         35 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       201        400        416       1034        167 
Trial 12 done!
******************
***************
Doing now trial 13 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 411   Min.   : 556   Min.   :1079   Min.   : 744  
 1st Qu.:2008   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2060  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3404   Max.   :3079   Max.   :2824   Max.   :2974  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3107        171        147         98        134        264         48 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       191        442        468        976        168 
Trial 13 done!
******************
***************
Doing now trial 14 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 289   Min.   : 643   Min.   : 985   Min.   : 869  
 1st Qu.:2008   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2110   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3205   Max.   :3068   Max.   :2809   Max.   :2946  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3048        144        188         99        152        264         39 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       188        437        452        903        182 
Trial 14 done!
******************
***************
Doing now trial 15 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 452   Min.   : 555   Min.   : 963   Min.   : 797  
 1st Qu.:2008   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3199   Max.   :2982   Max.   :2962   Max.   :2993  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3067        157        141        164        171        259         58 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       188        361        442        953        173 
Trial 15 done!
******************
***************
Doing now trial 16 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 110   Min.   : 684   Min.   :1040   Min.   : 831  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3501   Max.   :3047   Max.   :2756   Max.   :2804  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2749        175        171        133        125        228         61 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       157        337        368        853        141 
Trial 16 done!
******************
***************
Doing now trial 17 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 661   Min.   : 803   Min.   :1076   Min.   :1113  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3288   Max.   :2935   Max.   :2769   Max.   :2743  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2570        129        115         67        131        230         56 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       188        358        401        767        128 
Trial 17 done!
******************
***************
Doing now trial 18 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 480   Min.   : 563   Min.   : 787   Min.   : 798  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3134   Max.   :3194   Max.   :2963   Max.   :3046  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2441        120        108         50        108        204         56 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       158        321        398        820         98 
Trial 18 done!
******************
***************
Doing now trial 19 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 552   Min.   : 592   Min.   :1030   Min.   : 893  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3269   Max.   :3042   Max.   :2706   Max.   :2848  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2642        183        121         93        125        250         52 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        341        362        842        119 
Trial 19 done!
******************
***************
Doing now trial 20 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 465   Min.   : 535   Min.   :1027   Min.   : 874  
 1st Qu.:2009   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3149   Max.   :3002   Max.   :2755   Max.   :2887  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2467        115         96         87        119        210         56 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       167        326        440        748        103 
Trial 20 done!
******************
***************
Doing now trial 21 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 352   Min.   : 823   Min.   :1198   Min.   : 919  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3488   Max.   :3063   Max.   :2764   Max.   :2852  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2567        138        119        108        143        223         88 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       163        333        311        818        123 
Trial 21 done!
******************
***************
Doing now trial 22 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 451   Min.   : 539   Min.   : 934   Min.   : 917  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :4073   Max.   :4071   Max.   :4072   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2475        109        131         43        121        227         51 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       149        346        360        825        113 
Trial 22 done!
******************
***************
Doing now trial 23 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 260   Min.   : 866   Min.   :1033   Min.   : 834  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3327   Max.   :2959   Max.   :2788   Max.   :2966  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2546        123        130         58         94        241         46 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       186        326        318        919        105 
Trial 23 done!
******************
***************
Doing now trial 24 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 264   Min.   : 531   Min.   : 895   Min.   : 916  
 1st Qu.:2008   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3429   Max.   :3105   Max.   :2872   Max.   :2881  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2732        160        151         69        107        268         54 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       180        385        391        827        140 
Trial 24 done!
******************
***************
Doing now trial 25 of Citral_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 238   Min.   : 732   Min.   :1156   Min.   : 976  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3384   Max.   :2980   Max.   :2777   Max.   :2795  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2459        142        102         72        137        210         50 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       155        275        421        819         76 
Trial 25 done!
******************
#+end_example


** Diagnostic plots

The counts evolution is:

#+NAME: Citral-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file Citral-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_Citral_1_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 25 trials of =Citral_1= for tetrodeB.
#+RESULTS: Citral-count-evolution-tetB
[[file:locust20010214_tetB_fig/Citral-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: Citral-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file Citral-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_Citral_1_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 25 trials of =Citral= for tetrodeB.
#+RESULTS: Citral-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/Citral-waveform-evolution-tetB.png]]

The observed counting processes, inter spike intervals densities and raster plots are:

#+NAME: Citral-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file Citral-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi_raster(a_Citral_1_tetB,inter_trial_time=30,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for Citral.
#+RESULTS: Citral-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/Citral-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: Citral_1-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file Citral_1-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_Citral_1_tetB$spike_trains[[i]],
                    a_Citral_1_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: Citral_1-rt-test-tetB
[[file:locust20010214_tetB_fig/Citral_1-rt-test-tetB.png]]


** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-Citral
#+BEGIN_SRC R :session *R* :results silent
save(a_Citral_1_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_Citral_1_tetB$spike_trains))
    if (!is.null(a_Citral_1_tetB$spike_trains[[c_idx]]))
        cat(a_Citral_1_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_Citral_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC


* 25 trials with =Vanilla=

We will carry out an analysis of the 25 trials from =Vanilla_1=. 

** Do the job

#+NAME: Vanilla_1-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "Vanilla_1"
a_Vanilla_1_tetB=sort_many_trials(inter_trial_time=30*15000,
                                 get_data_fct=get_tetrode_data,
                                 stim_name=stim_name,
                                 trial_nbs=1:25,
                                 centers=a_Citral_1_tetB$centers,
                                 counts=a_Citral_1_tetB$counts,
                                 all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                            filter_length_1=filter_length, filter_length=filter_length, 
                                                            minimalDist_1=15, minimalDist=15, 
                                                            before=c_before, after=c_after, 
                                                            detection_cycle=c(0,0), verbose=1),
                                 layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                                 )
#+END_SRC

#+RESULTS: Vanilla_1-tetB
#+begin_example
***************
Doing now trial 1 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 587   Min.   : 801   Min.   : 996   Min.   : 836  
 1st Qu.:2009   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2108   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3311   Max.   :3020   Max.   :2708   Max.   :2918  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2676        156        143         29        115        240         49 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       141        285        368        998        152 
Trial 1 done!
******************
***************
Doing now trial 2 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 340   Min.   : 532   Min.   :1211   Min.   : 968  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3342   Max.   :3145   Max.   :2752   Max.   :2809  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2685        148        104         68         88        227         31 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       169        302        447        916        185 
Trial 2 done!
******************
***************
Doing now trial 3 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 576   Min.   : 670   Min.   : 907   Min.   : 793  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3275   Max.   :3080   Max.   :2797   Max.   :2738  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2715        107         92         81        167        161         83 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       207        274        532        826        185 
Trial 3 done!
******************
***************
Doing now trial 4 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 567   Min.   : 488   Min.   :1010   Min.   : 829  
 1st Qu.:2009   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3264   Max.   :3150   Max.   :2814   Max.   :2932  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2703        118        146         35        124        209         64 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       165        275        438        939        190 
Trial 4 done!
******************
***************
Doing now trial 5 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  14   Min.   : 759   Min.   :1218   Min.   : 968  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3470   Max.   :2967   Max.   :2622   Max.   :2865  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2740        168        122         42         89        222         72 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       171        262        377       1041        174 
Trial 5 done!
******************
***************
Doing now trial 6 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 593   Min.   : 529   Min.   : 918   Min.   : 967  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3234   Max.   :3080   Max.   :2796   Max.   :2923  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2661        129        135         72         84        203        111 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       134        268        332       1016        177 
Trial 6 done!
******************
***************
Doing now trial 7 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 218   Min.   : 741   Min.   :1134   Min.   : 930  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3331   Max.   :2925   Max.   :2715   Max.   :2796  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2864        143        165         60        117        239         62 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       162        302        397       1048        169 
Trial 7 done!
******************
***************
Doing now trial 8 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 187   Min.   : 490   Min.   :1124   Min.   : 833  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2105  
 Max.   :3313   Max.   :3034   Max.   :2658   Max.   :2894  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2822        107        140         82        116        258         74 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       164        326        338       1023        194 
Trial 8 done!
******************
***************
Doing now trial 9 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 563   Min.   : 555   Min.   :1119   Min.   : 832  
 1st Qu.:2009   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2104  
 Max.   :3540   Max.   :3074   Max.   :2668   Max.   :2927  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2621        115        155         28         83        216         56 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        277        335       1044        158 
Trial 9 done!
******************
***************
Doing now trial 10 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  60   Min.   : 712   Min.   :1002   Min.   : 801  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3476   Max.   :3001   Max.   :2765   Max.   :2843  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2839        174        138         48        133        287         66 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       180        284        416        925        188 
Trial 10 done!
******************
***************
Doing now trial 11 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 462   Min.   : 354   Min.   :1093   Min.   :1017  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3336   Max.   :3134   Max.   :2811   Max.   :2688  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2764        166        127         33         99        232         64 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       142        311        466        971        153 
Trial 11 done!
******************
***************
Doing now trial 12 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  26   Min.   :   0   Min.   : 405   Min.   : 995  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2014   1st Qu.:2010  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2110   3rd Qu.:2104   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :4072   Max.   :4072   Max.   :4072   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3415        223        143         43        126        319         63 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       119        403        613       1131        232 
Trial 12 done!
******************
***************
Doing now trial 13 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 476   Min.   : 946   Min.   : 884  
 1st Qu.:2008   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3905   Max.   :3084   Max.   :2789   Max.   :2799  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3247        154        113         47        149        216         68 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       172        266        657       1175        230 
Trial 13 done!
******************
***************
Doing now trial 14 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  92   Min.   : 636   Min.   : 979   Min.   : 974  
 1st Qu.:2009   1st Qu.:2014   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3710   Max.   :3006   Max.   :2666   Max.   :2822  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3090        111        139         48         87        161         91 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       171        221        616       1180        265 
Trial 14 done!
******************
***************
Doing now trial 15 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 487   Min.   : 427   Min.   :1149   Min.   : 993  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3359   Max.   :3119   Max.   :2747   Max.   :2750  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2931         82         98         42        116        243         61 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       177        281        586       1027        218 
Trial 15 done!
******************
***************
Doing now trial 16 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 636   Min.   : 733   Min.   :1249   Min.   :1164  
 1st Qu.:2009   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3217   Max.   :3069   Max.   :2679   Max.   :2780  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2863        116        125         47        151        183         54 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        191        584       1037        214 
Trial 16 done!
******************
***************
Doing now trial 17 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 803   Min.   :1160   Min.   : 925  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3633   Max.   :2993   Max.   :2700   Max.   :2813  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2874        118         90         75         59        189        107 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       155        279        545       1027        230 
Trial 17 done!
******************
***************
Doing now trial 18 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 493   Min.   : 602   Min.   :1269   Min.   : 842  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3251   Max.   :2925   Max.   :2670   Max.   :2823  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3035        155        103         66        103        308         76 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       166        396        529        941        192 
Trial 18 done!
******************
***************
Doing now trial 19 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 543   Min.   : 878   Min.   :1307   Min.   :1117  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3226   Max.   :2836   Max.   :2745   Max.   :2740  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2850        127        120        103         91        225         71 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       153        252        515       1009        184 
Trial 19 done!
******************
***************
Doing now trial 20 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 669   Min.   : 785   Min.   :1186   Min.   : 950  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3517   Max.   :2923   Max.   :2652   Max.   :2846  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2726        119         94         92         92        229         54 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       156        215        435       1065        175 
Trial 20 done!
******************
***************
Doing now trial 21 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 717   Min.   : 770   Min.   :1223   Min.   : 952  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3213   Max.   :3173   Max.   :2660   Max.   :2718  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2920        130        133        142        120        194         63 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       149        246        512       1000        231 
Trial 21 done!
******************
***************
Doing now trial 22 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 353   Min.   : 884   Min.   :1160   Min.   : 757  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2105   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3246   Max.   :2989   Max.   :2642   Max.   :2902  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2585         95         88         84        124        141         58 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       173        199        438        979        206 
Trial 22 done!
******************
***************
Doing now trial 23 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 434   Min.   : 443   Min.   :1156   Min.   :1059  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3367   Max.   :3060   Max.   :2695   Max.   :2778  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2797        100        102         76        158        197         69 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       171        237        473        997        217 
Trial 23 done!
******************
***************
Doing now trial 24 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 692   Min.   : 771   Min.   :1186   Min.   :1076  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3363   Max.   :2891   Max.   :2627   Max.   :2740  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2614        108        100         55        131        215         55 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       167        221        418        948        196 
Trial 24 done!
******************
***************
Doing now trial 25 of Vanilla_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 547   Min.   : 816   Min.   :1108   Min.   :1064  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3238   Max.   :2986   Max.   :2644   Max.   :2775  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2670        120         91         53        124        191         30 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       162        260        455       1002        182 
Trial 25 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: Vanilla_1-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file Vanilla_1-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_Vanilla_1_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 25 trials of =Vanilla_1= for tetrodeB.
#+RESULTS: Vanilla_1-count-evolution-tetB
[[file:locust20010214_tetB_fig/Vanilla_1-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: Vanilla_1-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file Vanilla_1-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_Vanilla_1_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 25 trials of =Vanilla_1= for tetrodeB.
#+RESULTS: Vanilla_1-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/Vanilla_1-waveform-evolution-tetB.png]]

The observed counting processes, inter spike intervals densities and raster plots are:

#+NAME: Vanilla_1-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file Vanilla_1-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi_raster(a_Vanilla_1_tetB,inter_trial_time=30,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for Vanilla.
#+RESULTS: Vanilla_1-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/Vanilla_1-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: Vanilla_1-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file Vanilla_1-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_Vanilla_1_tetB$spike_trains[[i]],
                    a_Vanilla_1_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: Vanilla_1-rt-test-tetB
[[file:locust20010214_tetB_fig/Vanilla_1-rt-test-tetB.png]]


** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-Vanilla_1
#+BEGIN_SRC R :session *R* :results silent
save(a_Vanilla_1_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_Vanilla_1_tetB$spike_trains))
    if (!is.null(a_Vanilla_1_tetB$spike_trains[[c_idx]]))
        cat(a_Vanilla_1_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_Vanilla_1_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC

* 25 trials with =Octanol=

We will carry out an analysis of the 25 trials from =Octanol_1=. The =LabBook= mentions the presence of noise in trials 10, 11 and 12, so we skip those.

** Do the job

#+NAME: Octanol_1-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "Octanol_1"
a_Octanol_1_tetB=sort_many_trials(inter_trial_time=30*15000,
                                  get_data_fct=get_tetrode_data,
                                  stim_name=stim_name,
                                  trial_nbs=c(1:9,13:25),
                                  centers=a_Vanilla_1_tetB$centers,
                                  counts=a_Vanilla_1_tetB$counts,
                                  all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                             filter_length_1=filter_length, filter_length=filter_length, 
                                                             minimalDist_1=15, minimalDist=15, 
                                                             before=c_before, after=c_after, 
                                                             detection_cycle=c(0,0), verbose=1),
                                  layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                                  )
#+END_SRC

#+RESULTS: Octanol_1-tetB
#+begin_example
***************
Doing now trial 1 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 121   Min.   : 543   Min.   :1128   Min.   : 856  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3644   Max.   :2940   Max.   :2598   Max.   :2767  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2973        174        106         47         87        179         43 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       140        283        499       1153        262 
Trial 1 done!
******************
***************
Doing now trial 2 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 264   Min.   : 429   Min.   : 996   Min.   : 934  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3253   Max.   :3094   Max.   :2753   Max.   :2802  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2997        176         89         67         90        199         80 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       190        331        478       1017        280 
Trial 2 done!
******************
***************
Doing now trial 3 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 604   Min.   : 938   Min.   :1095   Min.   :1139  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3525   Max.   :2929   Max.   :2706   Max.   :2787  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3122        168        128         82        112        239         60 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       183        309        589        956        296 
Trial 3 done!
******************
***************
Doing now trial 4 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 477   Min.   : 411   Min.   :1181   Min.   :1062  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2014  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2105   3rd Qu.:2099   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3401   Max.   :3053   Max.   :2698   Max.   :2770  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2668        138         97         48        118        139         66 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       160        195        482        995        230 
Trial 4 done!
******************
***************
Doing now trial 5 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 427   Min.   : 682   Min.   :1284   Min.   : 965  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3204   Max.   :2975   Max.   :2710   Max.   :2827  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2866        159        103        108         70        184         59 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       126        276        497       1034        250 
Trial 5 done!
******************
***************
Doing now trial 6 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 111   Min.   : 823   Min.   :1227   Min.   : 929  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3602   Max.   :2918   Max.   :2683   Max.   :2945  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2774        153        111         96         98        216         91 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       148        244        412        975        230 
Trial 6 done!
******************
***************
Doing now trial 7 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 513   Min.   : 559   Min.   : 988   Min.   : 845  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3267   Max.   :3016   Max.   :2748   Max.   :2797  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3066        184        132        101         96        283         73 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       137        323        425       1054        258 
Trial 7 done!
******************
***************
Doing now trial 8 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 511   Min.   : 972   Min.   :1117   Min.   :1076  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3328   Max.   :2901   Max.   :2653   Max.   :2783  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2749        126        149         77         66        199         47 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       124        243        454       1024        240 
Trial 8 done!
******************
***************
Doing now trial 9 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 408   Min.   : 440   Min.   :1135   Min.   : 792  
 1st Qu.:2010   1st Qu.:2014   1st Qu.:2017   1st Qu.:2013  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2105   3rd Qu.:2100   3rd Qu.:2095   3rd Qu.:2103  
 Max.   :3432   Max.   :3001   Max.   :2673   Max.   :2842  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2608        111        120         75         75        163         40 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       141        229        510        953        191 
Trial 9 done!
******************
***************
Doing now trial 13 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  53   Min.   : 725   Min.   : 977   Min.   : 908  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3654   Max.   :3091   Max.   :2811   Max.   :2742  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2952        137        106         81        118        170         91 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        249        470       1145        224 
Trial 13 done!
******************
***************
Doing now trial 14 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 531   Min.   :1010   Min.   : 931  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3674   Max.   :3033   Max.   :2769   Max.   :2872  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2970        172        111        111        103        209         70 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       157        271        455       1098        213 
Trial 14 done!
******************
***************
Doing now trial 15 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 106   Min.   : 581   Min.   :1057   Min.   : 979  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3395   Max.   :3043   Max.   :2758   Max.   :2835  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2693        187        114         87        116        169         46 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       163        174        498        940        199 
Trial 15 done!
******************
***************
Doing now trial 16 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 161   Min.   : 651   Min.   : 894   Min.   : 880  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3463   Max.   :2957   Max.   :2758   Max.   :2769  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3337        333        110         94         95        250         78 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       164        252        479       1084        398 
Trial 16 done!
******************
***************
Doing now trial 17 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  61   Min.   : 569   Min.   :1197   Min.   : 874  
 1st Qu.:2008   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3435   Max.   :2970   Max.   :2681   Max.   :2899  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3507        373        108         79        100        213         91 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       130        265        439       1166        543 
Trial 17 done!
******************
***************
Doing now trial 18 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 711   Min.   : 641   Min.   :1146   Min.   : 943  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3252   Max.   :3007   Max.   :2662   Max.   :2762  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3378        301        117         86         87        216         68 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       156        238        504       1145        460 
Trial 18 done!
******************
***************
Doing now trial 19 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 222   Min.   : 578   Min.   :1030   Min.   : 823  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3450   Max.   :2950   Max.   :2681   Max.   :2901  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3273        304        146         67         97        179         75 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       141        191        460       1138        475 
Trial 19 done!
******************
***************
Doing now trial 20 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 407   Min.   : 621   Min.   :1132   Min.   : 661  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3390   Max.   :2857   Max.   :2668   Max.   :2840  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3063        266        107         84         76        176         66 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       132        211        514       1081        350 
Trial 20 done!
******************
***************
Doing now trial 21 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 549   Min.   : 702   Min.   :1036   Min.   : 982  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3250   Max.   :2898   Max.   :2722   Max.   :2765  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3095        246        134         77        113        199         51 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       170        197        456       1073        379 
Trial 21 done!
******************
***************
Doing now trial 22 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 507   Min.   : 521   Min.   :1229   Min.   : 835  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3402   Max.   :2929   Max.   :2697   Max.   :3005  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3126        199        111        123        104        315         50 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       138        289        427       1045        325 
Trial 22 done!
******************
***************
Doing now trial 23 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 510   Min.   : 767   Min.   :1187   Min.   : 809  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3500   Max.   :2874   Max.   :2663   Max.   :2883  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3075        187        153        112        119        227         42 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       131        322        472       1045        265 
Trial 23 done!
******************
***************
Doing now trial 24 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 283   Min.   : 741   Min.   :1033   Min.   : 855  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2017   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3262   Max.   :2956   Max.   :2736   Max.   :2822  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2987        176        103        107        100        186         72 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       169        203        543       1095        233 
Trial 24 done!
******************
***************
Doing now trial 25 of Octanol_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 506   Min.   : 632   Min.   : 992   Min.   : 896  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3356   Max.   :3000   Max.   :2796   Max.   :2888  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2948        221        136         59        103        195         59 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        200        534       1045        242 
Trial 25 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: Octanol_1-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file Octanol_1-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_Octanol_1_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 25 trials of =Octanol_1= for tetrodeB.
#+RESULTS: Octanol_1-count-evolution-tetB
[[file:locust20010214_tetB_fig/Octanol_1-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: Octanol_1-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file Octanol_1-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_Octanol_1_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 25 trials of =Octanol_1= for tetrodeB.
#+RESULTS: Octanol_1-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/Octanol_1-waveform-evolution-tetB.png]]

The observed counting processes, inter spike intervals densities and raster plots are:

#+NAME: Octanol_1-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file Octanol_1-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi_raster(a_Octanol_1_tetB,inter_trial_time=30,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for Octanol.
#+RESULTS: Octanol_1-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/Octanol_1-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: Octanol_1-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file Octanol_1-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_Octanol_1_tetB$spike_trains[[i]],
                    a_Octanol_1_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: Octanol_1-rt-test-tetB
[[file:locust20010214_tetB_fig/Octanol_1-rt-test-tetB.png]]


** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-Octanol_1
#+BEGIN_SRC R :session *R* :results silent
save(a_Octanol_1_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_Octanol_1_tetB$spike_trains))
    if (!is.null(a_Octanol_1_tetB$spike_trains[[c_idx]]))
        cat(a_Octanol_1_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_Octanol_1_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC

* 25 trials with =Mint=

We will carry out an analysis of the 25 trials from =Mint_1=. 

** Do the job

#+NAME: Mint_1-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "Mint_1"
a_Mint_1_tetB=sort_many_trials(inter_trial_time=30*15000,
                               get_data_fct=get_tetrode_data,
                               stim_name=stim_name,
                               trial_nbs=1:25,
                               centers=a_Octanol_1_tetB$centers,
                               counts=a_Octanol_1_tetB$counts,
                               all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                          filter_length_1=filter_length, filter_length=filter_length, 
                                                          minimalDist_1=15, minimalDist=15, 
                                                          before=c_before, after=c_after, 
                                                          detection_cycle=c(0,0), verbose=1),
                               layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                               )
#+END_SRC

#+RESULTS: Mint_1-tetB
#+begin_example
***************
Doing now trial 1 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 557   Min.   :1021   Min.   : 933  
 1st Qu.:2007   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2110   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2107  
 Max.   :3728   Max.   :2960   Max.   :2811   Max.   :2703  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3410        171        209         74        166        299         73 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       173        295        458       1233        259 
Trial 1 done!
******************
***************
Doing now trial 2 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 431   Min.   : 573   Min.   :1076   Min.   : 708  
 1st Qu.:2008   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3530   Max.   :3092   Max.   :2816   Max.   :2733  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3234        166        155         65        159        221         69 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       152        222        491       1275        259 
Trial 2 done!
******************
***************
Doing now trial 3 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 119   Min.   : 802   Min.   : 964   Min.   : 792  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3474   Max.   :3045   Max.   :2801   Max.   :2919  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3053        134        159         72         77        304         56 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       157        304        451       1112        227 
Trial 3 done!
******************
***************
Doing now trial 4 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 751   Min.   : 780   Min.   :1189   Min.   :1045  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3296   Max.   :2968   Max.   :2690   Max.   :2771  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2952        116        182         67        105        286         69 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       157        225        411       1120        214 
Trial 4 done!
******************
***************
Doing now trial 5 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 466   Min.   : 767   Min.   :1003   Min.   : 779  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3420   Max.   :3104   Max.   :2717   Max.   :2882  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3087        123        189         79        121        258         81 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       140        259        400       1187        250 
Trial 5 done!
******************
***************
Doing now trial 6 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 685   Min.   : 800   Min.   :1084   Min.   : 804  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3311   Max.   :2889   Max.   :2699   Max.   :2822  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2883        120        120         67        111        257         47 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       130        293        462       1080        196 
Trial 6 done!
******************
***************
Doing now trial 7 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 713   Min.   : 957   Min.   : 735  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3754   Max.   :2979   Max.   :2837   Max.   :2976  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2967        156        163         99         85        229         77 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       136        258        492       1045        227 
Trial 7 done!
******************
***************
Doing now trial 8 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 387   Min.   : 470   Min.   :1148   Min.   : 876  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3316   Max.   :2989   Max.   :2622   Max.   :2836  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2833        156         83         53        102        170         79 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       140        239        477       1121        213 
Trial 8 done!
******************
***************
Doing now trial 9 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 465   Min.   : 758   Min.   :1084   Min.   :1006  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3539   Max.   :2977   Max.   :2663   Max.   :2734  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2969        137        119         88        111        254         60 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       164        200        481       1128        227 
Trial 9 done!
******************
***************
Doing now trial 10 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 456   Min.   :1201   Min.   : 843  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2105  
 Max.   :3784   Max.   :3118   Max.   :2653   Max.   :2851  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2925        145        110         55        100        213        111 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       178        197        457       1149        210 
Trial 10 done!
******************
***************
Doing now trial 11 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 207   Min.   :   0   Min.   : 641   Min.   : 717  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2103   3rd Qu.:2097   3rd Qu.:2106  
 Max.   :4073   Max.   :4072   Max.   :4073   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3096        167        121         98        134        269        102 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       143        282        454       1090        236 
Trial 11 done!
******************
***************
Doing now trial 12 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 146   Min.   : 807   Min.   :1064   Min.   : 907  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2110   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2107  
 Max.   :3519   Max.   :2893   Max.   :2690   Max.   :2851  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3367        166        142         76        121        318         94 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       172        284        461       1294        239 
Trial 12 done!
******************
***************
Doing now trial 13 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 396   Min.   : 780   Min.   :1268   Min.   : 815  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3800   Max.   :2965   Max.   :2719   Max.   :2933  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3026        165        146         82         98        189        107 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       139        239        465       1199        197 
Trial 13 done!
******************
***************
Doing now trial 14 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 477   Min.   : 599   Min.   :1043   Min.   : 874  
 1st Qu.:2008   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2105  
 Max.   :3613   Max.   :2978   Max.   :2694   Max.   :2720  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3035        167        151         47        157        253         71 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       170        163        395       1229        232 
Trial 14 done!
******************
***************
Doing now trial 15 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  11   Min.   : 613   Min.   :1073   Min.   : 752  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3787   Max.   :3036   Max.   :2751   Max.   :2880  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2923        193         83         53        140        201         79 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       148        275        382       1136        233 
Trial 15 done!
******************
***************
Doing now trial 16 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 438   Min.   : 609   Min.   :1196   Min.   : 853  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3305   Max.   :2989   Max.   :2735   Max.   :2748  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2976        133        142         98        108        305         96 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       119        260        417       1087        211 
Trial 16 done!
******************
***************
Doing now trial 17 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 498   Min.   : 582   Min.   :1189   Min.   : 964  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3368   Max.   :2892   Max.   :2566   Max.   :2728  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2828        184        132         70        102        164         93 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       158        183        398       1128        216 
Trial 17 done!
******************
***************
Doing now trial 18 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 132   Min.   : 630   Min.   :1005   Min.   : 860  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2106  
 Max.   :3729   Max.   :3001   Max.   :2759   Max.   :3011  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3044        139        159        101        153        246         75 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       167        347        339       1093        225 
Trial 18 done!
******************
***************
Doing now trial 19 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 610   Min.   : 476   Min.   :1102   Min.   : 966  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3561   Max.   :3136   Max.   :2683   Max.   :2701  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2775        106        161         98         86        349         52 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       118        254        300       1046        205 
Trial 19 done!
******************
***************
Doing now trial 20 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 311   Min.   : 312   Min.   : 976   Min.   : 649  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3430   Max.   :3071   Max.   :2844   Max.   :2895  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2897        121        162        151         92        304         47 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       134        257        338       1077        214 
Trial 20 done!
******************
***************
Doing now trial 21 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  36   Min.   : 676   Min.   : 977   Min.   :1049  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3779   Max.   :3091   Max.   :2773   Max.   :2897  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2976        117        171        115         89        264         72 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        313        413       1065        203 
Trial 21 done!
******************
***************
Doing now trial 22 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 632   Min.   : 658   Min.   :1129   Min.   : 992  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3293   Max.   :2970   Max.   :2694   Max.   :2810  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2918        123        159         80         93        359         60 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       119        264        349       1117        195 
Trial 22 done!
******************
***************
Doing now trial 23 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  21   Min.   : 712   Min.   :1034   Min.   : 989  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3789   Max.   :2936   Max.   :2621   Max.   :2850  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2980        119        139         68        119        310         77 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       140        277        468       1060        203 
Trial 23 done!
******************
***************
Doing now trial 24 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  53   Min.   : 568   Min.   : 963   Min.   :1062  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3618   Max.   :2990   Max.   :2715   Max.   :2738  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3032        109        161         70        120        288         76 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       143        309        489       1055        212 
Trial 24 done!
******************
***************
Doing now trial 25 of Mint_1
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 521   Min.   : 750   Min.   :1248   Min.   : 907  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3510   Max.   :2901   Max.   :2666   Max.   :2803  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2905        180        107         53        112        147        124 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       179        249        515       1054        185 
Trial 25 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: Mint_1-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file Mint_1-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_Mint_1_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 25 trials of =Mint_1= for tetrodeB.
#+RESULTS: Mint_1-count-evolution-tetB
[[file:locust20010214_tetB_fig/Mint_1-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: Mint_1-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file Mint_1-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_Mint_1_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 25 trials of =Mint_1= for tetrodeB.
#+RESULTS: Mint_1-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/Mint_1-waveform-evolution-tetB.png]]

The observed counting processes, inter spike intervals densities and raster plots are:

#+NAME: Mint_1-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file Mint_1-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi_raster(a_Mint_1_tetB,inter_trial_time=30,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for Mint.
#+RESULTS: Mint_1-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/Mint_1-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: Mint_1-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file Mint_1-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_Mint_1_tetB$spike_trains[[i]],
                    a_Mint_1_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: Mint_1-rt-test-tetB
[[file:locust20010214_tetB_fig/Mint_1-rt-test-tetB.png]]


** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-Mint_1
#+BEGIN_SRC R :session *R* :results silent
save(a_Mint_1_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_Mint_1_tetB$spike_trains))
    if (!is.null(a_Mint_1_tetB$spike_trains[[c_idx]]))
        cat(a_Mint_1_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_Mint_1_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC

* 25 trials with =C3H_2=

We will carry out an analysis of the second set of 25 trials with Cis-3-Hexen-1-ol from =C3H_2=. 

** Do the job

#+NAME: C3H_2-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "C3H_2"
a_C3H_2_tetB=sort_many_trials(inter_trial_time=30*15000,
                              get_data_fct=get_tetrode_data,
                              stim_name=stim_name,
                              trial_nbs=1:25,
                              centers=a_Mint_1_tetB$centers,
                              counts=a_Mint_1_tetB$counts,
                              all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                         filter_length_1=filter_length, filter_length=filter_length, 
                                                         minimalDist_1=15, minimalDist=15, 
                                                         before=c_before, after=c_after, 
                                                         detection_cycle=c(0,0), verbose=1),
                              layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                              )
#+END_SRC

#+RESULTS: C3H_2-tetB
#+begin_example
***************
Doing now trial 1 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 134   Min.   : 746   Min.   :1242   Min.   : 898  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3341   Max.   :2981   Max.   :2648   Max.   :2786  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2986        156        128         85         68        253         73 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       151        349        433       1062        228 
Trial 1 done!
******************
***************
Doing now trial 2 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 419   Min.   : 689   Min.   : 973   Min.   : 994  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3517   Max.   :2912   Max.   :2803   Max.   :2751  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2818        141        133         76         92        192         82 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       176        240        505        983        198 
Trial 2 done!
******************
***************
Doing now trial 3 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 585   Min.   : 651   Min.   :1007   Min.   : 762  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3287   Max.   :2945   Max.   :2757   Max.   :2863  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2863        175        148         72         96        176         86 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       136        331        466        983        194 
Trial 3 done!
******************
***************
Doing now trial 4 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 305   Min.   : 493   Min.   :1078   Min.   : 949  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3583   Max.   :2963   Max.   :2735   Max.   :2844  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2893        146        126         65        101        194        101 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       169        258        550        970        213 
Trial 4 done!
******************
***************
Doing now trial 5 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 420   Min.   : 524   Min.   :1090   Min.   : 986  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2056  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3308   Max.   :2980   Max.   :2683   Max.   :2761  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2793        118        124         62         77        212        105 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       159        269        478       1000        189 
Trial 5 done!
******************
***************
Doing now trial 6 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 539   Min.   : 588   Min.   :1167   Min.   :1041  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3496   Max.   :2971   Max.   :2720   Max.   :2821  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2904        127        110         90        110        149        159 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       168        208        556       1001        226 
Trial 6 done!
******************
***************
Doing now trial 7 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 649   Min.   : 471   Min.   :1145   Min.   :1063  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3284   Max.   :3022   Max.   :2732   Max.   :2807  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2696        138        134        110         64        227         71 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       149        274        396        948        185 
Trial 7 done!
******************
***************
Doing now trial 8 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 603   Min.   : 783   Min.   :1175   Min.   : 905  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3360   Max.   :2968   Max.   :2679   Max.   :2729  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2818        150        143         80        113        158        119 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       151        261        485        961        197 
Trial 8 done!
******************
***************
Doing now trial 9 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 633   Min.   : 840   Min.   : 970   Min.   : 902  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3387   Max.   :2909   Max.   :2788   Max.   :2757  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2845        137        149         84        120        211        114 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       142        269        439        983        197 
Trial 9 done!
******************
***************
Doing now trial 10 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 181   Min.   :   0   Min.   : 982   Min.   : 784  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :4073   Max.   :4072   Max.   :4072   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3166        154        142        174        143        226         86 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       195        303        469       1027        247 
Trial 10 done!
******************
***************
Doing now trial 11 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 464   Min.   : 493   Min.   : 966   Min.   : 825  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2014   1st Qu.:2010  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2111   3rd Qu.:2104   3rd Qu.:2099   3rd Qu.:2107  
 Max.   :3330   Max.   :3153   Max.   :2687   Max.   :2837  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3432        180        209        108        122        262        109 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       187        286        511       1209        249 
Trial 11 done!
******************
***************
Doing now trial 12 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 100   Min.   : 606   Min.   : 953   Min.   : 835  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3475   Max.   :2963   Max.   :2758   Max.   :2883  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2975        134        117        122         71        193        119 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       167        252        522       1062        216 
Trial 12 done!
******************
***************
Doing now trial 13 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 603   Min.   : 529   Min.   :1159   Min.   :1063  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3480   Max.   :3062   Max.   :2696   Max.   :2708  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2782        135        132         84        108        155        124 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       132        223        503       1006        180 
Trial 13 done!
******************
***************
Doing now trial 14 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 176   Min.   : 340   Min.   : 326   Min.   : 454  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :4073   Max.   :4072   Max.   :4073   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2776        103         93         83         81        175        127 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        206        547        977        230 
Trial 14 done!
******************
***************
Doing now trial 15 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 671   Min.   : 636   Min.   :1102   Min.   : 929  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2104  
 Max.   :3454   Max.   :3021   Max.   :2730   Max.   :2808  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2744        155        135         75         83        182        104 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       128        263        443        974        202 
Trial 15 done!
******************
***************
Doing now trial 16 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 495   Min.   : 402   Min.   :1020   Min.   :1067  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3337   Max.   :3030   Max.   :2784   Max.   :2781  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2853        143        123         71        132        260         91 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       146        254        442        986        205 
Trial 16 done!
******************
***************
Doing now trial 17 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  99   Min.   : 530   Min.   : 968   Min.   : 851  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3608   Max.   :3095   Max.   :2803   Max.   :2919  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2798        104        152         92        129        171        135 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       156        217        469        955        218 
Trial 17 done!
******************
***************
Doing now trial 18 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 587   Min.   : 860   Min.   :1153   Min.   : 737  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3349   Max.   :2985   Max.   :2675   Max.   :2831  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2933        138        152        109        102        186        134 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       152        297        494        956        213 
Trial 18 done!
******************
***************
Doing now trial 19 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 583   Min.   :1078   Min.   : 816  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3779   Max.   :2989   Max.   :2808   Max.   :2778  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3077        121        144         83        156        130        138 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       192        249        566       1071        227 
Trial 19 done!
******************
***************
Doing now trial 20 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 660   Min.   : 894   Min.   :1010  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3894   Max.   :3080   Max.   :2772   Max.   :2781  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2857        149        134         59        105        191        130 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       169        283        511        939        187 
Trial 20 done!
******************
***************
Doing now trial 21 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 658   Min.   :1186   Min.   : 954  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3689   Max.   :3034   Max.   :2710   Max.   :2742  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2986        135        152         79        178        217        147 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        338        478        897        204 
Trial 21 done!
******************
***************
Doing now trial 22 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 754   Min.   :1169   Min.   : 888  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3660   Max.   :2997   Max.   :2792   Max.   :2807  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2990        157        147         66        138        191        167 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        226        578        939        220 
Trial 22 done!
******************
***************
Doing now trial 23 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 288   Min.   : 912   Min.   : 795  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3683   Max.   :3102   Max.   :2818   Max.   :2822  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3023        156        130         96        145        215        154 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       142        283        514        983        205 
Trial 23 done!
******************
***************
Doing now trial 24 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 599   Min.   : 665   Min.   :1122   Min.   : 938  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3358   Max.   :3124   Max.   :2710   Max.   :2794  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3017        130        147         91        143        195        148 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       162        272        531        990        208 
Trial 24 done!
******************
***************
Doing now trial 25 of C3H_2
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 507   Min.   : 509   Min.   : 891   Min.   : 808  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3552   Max.   :3047   Max.   :2721   Max.   :2829  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3109        127        173         85        167        226        112 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       205        361        509        918        226 
Trial 25 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: C3H_2-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file C3H_2-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_C3H_2_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 25 trials of =C3H_2= for tetrodeB.
#+RESULTS: C3H_2-count-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_2-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: C3H_2-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file C3H_2-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_C3H_2_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 25 trials of =C3H_2= for tetrodeB.
#+RESULTS: C3H_2-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_2-waveform-evolution-tetB.png]]

The observed counting processes, inter spike intervals densities and raster plots are:

#+NAME: C3H_2-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file C3H_2-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi_raster(a_C3H_2_tetB,inter_trial_time=30,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for Mint.
#+RESULTS: C3H_2-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/C3H_2-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: C3H_2-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file C3H_2-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_C3H_2_tetB$spike_trains[[i]],
                    a_C3H_2_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: C3H_2-rt-test-tetB
[[file:locust20010214_tetB_fig/C3H_2-rt-test-tetB.png]]


** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-C3H_2
#+BEGIN_SRC R :session *R* :results silent
save(a_C3H_2_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_C3H_2_tetB$spike_trains))
    if (!is.null(a_C3H_2_tetB$spike_trains[[c_idx]]))
        cat(a_C3H_2_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_C3H_2_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC

* 30 trials of =Spontaneous_3=

We must redefine our =get_tetrode_data= function since the =HDF5= containing the data is not the one where the previous data were stored:

** Redefine =get_tetrode_data=

#+NAME: get_tetrode_data2
#+BEGIN_SRC R :session *R* :results silent
get_tetrode_data = function(trial_idx,stim="Spontaneous_1") {
    prefix = ifelse(trial_idx<10,
                    paste0("/",stim,"/trial_0",trial_idx),
                    paste0("/",stim,"/trial_",trial_idx)
                    )
    cbind(h5read("locust20010214_part2.hdf5", paste0(prefix,"/ch02")),
          h5read("locust20010214_part2.hdf5", paste0(prefix,"/ch03")),
          h5read("locust20010214_part2.hdf5", paste0(prefix,"/ch05")),
          h5read("locust20010214_part2.hdf5", paste0(prefix,"/ch07")))
}
#+END_SRC

** Do the job

#+NAME: Spontaneous_3-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "Spontaneous_3"
a_Spontaneous_3_tetB=sort_many_trials(inter_trial_time=30*15000,
                                      get_data_fct=get_tetrode_data,
                                      stim_name=stim_name,
                                      trial_nbs=1:30,
                                      centers=a_C3H_2_tetB$centers,
                                      counts=a_C3H_2_tetB$counts,
                                      all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                                 filter_length_1=filter_length, filter_length=filter_length, 
                                                                 minimalDist_1=15, minimalDist=15, 
                                                                 before=c_before, after=c_after, 
                                                                 detection_cycle=c(0,0), verbose=1),
                                      layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                                      )
#+END_SRC

#+RESULTS: Spontaneous_3-tetB
#+begin_example
***************
Doing now trial 1 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 471   Min.   : 777   Min.   :1190   Min.   : 819  
 1st Qu.:2006   1st Qu.:2011   1st Qu.:2014   1st Qu.:2010  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2110   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2107  
 Max.   :3480   Max.   :2949   Max.   :2681   Max.   :2855  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3412        144        165         94        227        232        166 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       201        358        521       1062        242 
Trial 1 done!
******************
***************
Doing now trial 2 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 544   Min.   :1027   Min.   : 964  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3681   Max.   :3032   Max.   :2741   Max.   :2852  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3123        124        143         71        159        194        210 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       219        226        542       1039        196 
Trial 2 done!
******************
***************
Doing now trial 3 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 389   Min.   : 682   Min.   :1057   Min.   : 809  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3339   Max.   :3014   Max.   :2713   Max.   :2769  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2993        133        100         60        148        199        187 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       186        217        562        988        213 
Trial 3 done!
******************
***************
Doing now trial 4 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 407   Min.   : 419   Min.   :1186   Min.   :1084  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2106  
 Max.   :3422   Max.   :2973   Max.   :2701   Max.   :2737  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3075        126        157         54        171        220        165 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       165        287        501       1021        208 
Trial 4 done!
******************
***************
Doing now trial 5 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 270   Min.   : 548   Min.   : 906   Min.   : 928  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2014   1st Qu.:2010  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2110   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3577   Max.   :2933   Max.   :2716   Max.   :2780  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3050        177        173         68        170        239        147 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       187        271        432        989        197 
Trial 5 done!
******************
***************
Doing now trial 6 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 335   Min.   : 638   Min.   :1212   Min.   : 758  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2110   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3372   Max.   :3128   Max.   :2745   Max.   :2875  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3177        136        133        114        165        234        162 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       199        348        481        974        231 
Trial 6 done!
******************
***************
Doing now trial 7 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 491   Min.   : 748   Min.   :1215   Min.   : 945  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3560   Max.   :2988   Max.   :2685   Max.   :2759  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2901        120        108         70        172        181        188 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       189        243        531        915        184 
Trial 7 done!
******************
***************
Doing now trial 8 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  43   Min.   : 548   Min.   : 971   Min.   : 873  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2106  
 Max.   :3831   Max.   :3107   Max.   :2811   Max.   :2838  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3029        129        166         95        156        205        147 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       193        283        463        976        216 
Trial 8 done!
******************
***************
Doing now trial 9 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 349   Min.   : 333   Min.   : 955   Min.   : 907  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3518   Max.   :3096   Max.   :2800   Max.   :2895  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2953        107        122         72        127        212        201 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       162        267        562        925        196 
Trial 9 done!
******************
***************
Doing now trial 10 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 508   Min.   : 331   Min.   :1147   Min.   : 862  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :4073   Max.   :4072   Max.   :4073   Max.   :3924  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3173        141        143        151        100        243        162 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       174        335        549        943        232 
Trial 10 done!
******************
***************
Doing now trial 11 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 480   Min.   :1016   Min.   : 908  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3718   Max.   :3073   Max.   :2870   Max.   :2848  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3225        177        110         73         98        224        203 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       136        314        622       1048        220 
Trial 11 done!
******************
***************
Doing now trial 12 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 558   Min.   : 621   Min.   :1157   Min.   : 808  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3443   Max.   :2978   Max.   :2778   Max.   :2855  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3107        141        184         91        105        214        201 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       174        275        563        947        212 
Trial 12 done!
******************
***************
Doing now trial 13 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 721   Min.   :1186   Min.   : 739  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3503   Max.   :3011   Max.   :2745   Max.   :2776  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3183        121        142         74        136        189        205 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       171        215        659       1045        226 
Trial 13 done!
******************
***************
Doing now trial 14 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 339   Min.   : 567   Min.   :1232   Min.   : 878  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3402   Max.   :2954   Max.   :2730   Max.   :2822  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3071        104        124         59        140        194        195 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       165        242        649        978        221 
Trial 14 done!
******************
***************
Doing now trial 15 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 491   Min.   : 670   Min.   : 985   Min.   : 821  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3507   Max.   :3050   Max.   :2804   Max.   :2754  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2954        105        171         84        107        181        198 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       142        271        564        937        194 
Trial 15 done!
******************
***************
Doing now trial 16 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 536   Min.   :1044   Min.   : 993  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3821   Max.   :3082   Max.   :2809   Max.   :2845  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2981        121        124         89        190        182        162 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       169        262        525        935        222 
Trial 16 done!
******************
***************
Doing now trial 17 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 776   Min.   :1125   Min.   : 408  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3730   Max.   :2964   Max.   :2678   Max.   :2938  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2975        125        151        100        140        175        194 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       178        244        537        919        212 
Trial 17 done!
******************
***************
Doing now trial 18 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 483   Min.   :1188   Min.   : 953  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2016   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3619   Max.   :3012   Max.   :2675   Max.   :2781  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2934        112        135         97        186        189        195 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       165        342        427        884        202 
Trial 18 done!
******************
***************
Doing now trial 19 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 130   Min.   : 795   Min.   :1146   Min.   : 843  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3352   Max.   :2913   Max.   :2639   Max.   :2831  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2867        155        127         80        112        203        172 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       175        268        502        888        185 
Trial 19 done!
******************
***************
Doing now trial 20 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  57   Min.   :   0   Min.   :1185   Min.   : 938  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :4073   Max.   :4073   Max.   :4073   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2983        146        159         93        167        202        179 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       175        270        572        845        175 
Trial 20 done!
******************
***************
Doing now trial 21 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 445   Min.   : 898   Min.   : 910  
 1st Qu.:2006   1st Qu.:2010   1st Qu.:2014   1st Qu.:2010  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2111   3rd Qu.:2105   3rd Qu.:2100   3rd Qu.:2107  
 Max.   :3661   Max.   :3053   Max.   :2853   Max.   :2755  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3484        194        181        127        164        259        175 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       164        385        564       1016        255 
Trial 21 done!
******************
***************
Doing now trial 22 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 226   Min.   : 399   Min.   :1195   Min.   : 838  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3605   Max.   :3032   Max.   :2740   Max.   :2890  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3093        141        143         47        102        164        249 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       146        229        643        983        246 
Trial 22 done!
******************
***************
Doing now trial 23 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 297   Min.   : 426   Min.   : 973   Min.   :1016  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2110   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3374   Max.   :3127   Max.   :2725   Max.   :2796  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3090        153        165         85        167        217        180 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       206        317        529        889        182 
Trial 23 done!
******************
***************
Doing now trial 24 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 682   Min.   : 939   Min.   : 897  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3724   Max.   :3025   Max.   :2833   Max.   :2870  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3005        105        129         79        169        159        265 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       182        233        643        863        178 
Trial 24 done!
******************
***************
Doing now trial 25 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 633   Min.   :1050   Min.   : 754  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3821   Max.   :2965   Max.   :2692   Max.   :2826  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3029        134        165         70        172        191        207 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       174        256        571        876        213 
Trial 25 done!
******************
***************
Doing now trial 26 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 253   Min.   : 795   Min.   :1093   Min.   : 873  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3399   Max.   :2988   Max.   :2762   Max.   :2853  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2871        123        142         56        163        172        227 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       127        284        529        854        194 
Trial 26 done!
******************
***************
Doing now trial 27 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 509   Min.   : 897   Min.   :1116   Min.   : 922  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3381   Max.   :2967   Max.   :2790   Max.   :2747  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2787        132         81         67        165        191        207 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       138        258        529        857        162 
Trial 27 done!
******************
***************
Doing now trial 28 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 589   Min.   : 644   Min.   : 915   Min.   : 915  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3415   Max.   :2935   Max.   :2786   Max.   :2772  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2927        184        220        134        166        241        158 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       113        365        372        797        177 
Trial 28 done!
******************
***************
Doing now trial 29 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 683   Min.   :1036   Min.   : 806  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3388   Max.   :2969   Max.   :2725   Max.   :2884  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3004        167        168        118        139        223        176 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       155        269        554        838        197 
Trial 29 done!
******************
***************
Doing now trial 30 of Spontaneous_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 506   Min.   : 826   Min.   : 955  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3620   Max.   :3044   Max.   :2959   Max.   :2739  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2981        174        224        119        166        209        145 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       149        321        474        794        206 
Trial 30 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: Spontaneous_3-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file Spontaneous_3-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_Spontaneous_3_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 30 trials of =Spontaneous_3= for tetrodeB.
#+RESULTS: Spontaneous_3-count-evolution-tetB
[[file:locust20010214_tetB_fig/Spontaneous_3-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: Spontaneous_3-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file Spontaneous_3-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_Spontaneous_3_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 30 trials of =Spontaneous_3= for tetrodeB.
#+RESULTS: Spontaneous_3-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/Spontaneous_3-waveform-evolution-tetB.png]]

The observed counting processes and inter spike intervals densities are:

#+NAME: Spontaneous_3-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file Spontaneous_3-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi(a_Spontaneous_3_tetB,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for =Spontaneous_3=.
#+RESULTS: Spontaneous_3-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/Spontaneous_3-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: Spontaneous_3-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file Spontaneous_3-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_Spontaneous_3_tetB$spike_trains[[i]],
                    a_Spontaneous_3_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: Spontaneous_3-rt-test-tetB
[[file:locust20010214_tetB_fig/Spontaneous_3-rt-test-tetB.png]]


** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-Spontaneous_3
#+BEGIN_SRC R :session *R* :results silent
save(a_Spontaneous_3_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_Spontaneous_3_tetB$spike_trains))
    if (!is.null(a_Spontaneous_3_tetB$spike_trains[[c_idx]]))
        cat(a_Spontaneous_3_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_Spontaneous_3_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC


* 30 trials of =Spontaneous_4=

We now analyze the 30 trials from =Spontaneous_4=.

** Do the job

#+NAME: Spontaneous_4-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "Spontaneous_4"
a_Spontaneous_4_tetB=sort_many_trials(inter_trial_time=30*15000,
                                      get_data_fct=get_tetrode_data,
                                      stim_name=stim_name,
                                      trial_nbs=1:30,
                                      centers=a_Spontaneous_3_tetB$centers,
                                      counts=a_Spontaneous_3_tetB$counts,
                                      all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                                 filter_length_1=filter_length, filter_length=filter_length, 
                                                                 minimalDist_1=15, minimalDist=15, 
                                                                 before=c_before, after=c_after, 
                                                                 detection_cycle=c(0,0), verbose=1),
                                      layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                                      )
#+END_SRC

#+RESULTS: Spontaneous_4-tetB
#+begin_example
***************
Doing now trial 1 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 700   Min.   :1114   Min.   : 741  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3948   Max.   :3022   Max.   :2658   Max.   :2784  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2830        123        122         68         74        168        236 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       155        210        707        795        172 
Trial 1 done!
******************
***************
Doing now trial 2 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 590   Min.   : 852   Min.   :1178   Min.   : 855  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3444   Max.   :2884   Max.   :2721   Max.   :2833  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2725        106        133         80         82        196        235 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       188        201        616        703        185 
Trial 2 done!
******************
***************
Doing now trial 3 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 299   Min.   : 453   Min.   : 985   Min.   : 724  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3531   Max.   :3083   Max.   :2734   Max.   :2726  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2772        129        139         99        120        187        185 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       151        267        537        772        186 
Trial 3 done!
******************
***************
Doing now trial 4 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 652   Min.   : 441   Min.   :1172   Min.   : 981  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3347   Max.   :3096   Max.   :2669   Max.   :2790  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2988         98        152         89        158        194        277 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        232        606        834        187 
Trial 4 done!
******************
***************
Doing now trial 5 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  72   Min.   : 375   Min.   : 956   Min.   :1074  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3467   Max.   :3024   Max.   :2793   Max.   :2801  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2734        108        151         82         95        189        257 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       142        237        537        770        166 
Trial 5 done!
******************
***************
Doing now trial 6 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   4   Min.   : 511   Min.   : 946   Min.   :1125  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3674   Max.   :2998   Max.   :2776   Max.   :2755  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2829        159        160        109        185        194        200 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       144        275        524        700        179 
Trial 6 done!
******************
***************
Doing now trial 7 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  29   Min.   : 685   Min.   :1112   Min.   : 949  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3397   Max.   :2923   Max.   :2701   Max.   :2756  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2720        139        171         71        163        180        207 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       181        240        487        714        167 
Trial 7 done!
******************
***************
Doing now trial 8 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 612   Min.   : 414   Min.   : 947   Min.   : 964  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3270   Max.   :2980   Max.   :2658   Max.   :2822  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2664        110        180         63        153        180        197 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       188        248        480        706        159 
Trial 8 done!
******************
***************
Doing now trial 9 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 635   Min.   : 994   Min.   : 843  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3408   Max.   :2988   Max.   :2839   Max.   :2801  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2785        129        166         85        126        167        231 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       145        234        587        717        198 
Trial 9 done!
******************
***************
Doing now trial 10 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 495   Min.   :   0   Min.   : 905   Min.   : 902  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :4073   Max.   :4072   Max.   :4073   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2860        201        158         65        101        250        162 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       147        341        550        706        179 
Trial 10 done!
******************
***************
Doing now trial 11 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 184   Min.   : 644   Min.   : 955   Min.   : 886  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3765   Max.   :2987   Max.   :2816   Max.   :2827  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2780        130        129         57         81        133        301 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       108        234        710        728        169 
Trial 11 done!
******************
***************
Doing now trial 12 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  56   Min.   : 769   Min.   :1108   Min.   : 966  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3754   Max.   :3021   Max.   :2711   Max.   :2805  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2830        159        141         78        107        185        241 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       146        248        617        731        177 
Trial 12 done!
******************
***************
Doing now trial 13 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  41   Min.   : 445   Min.   : 800   Min.   : 671  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2110   3rd Qu.:2103   3rd Qu.:2099   3rd Qu.:2107  
 Max.   :3445   Max.   :2984   Max.   :2891   Max.   :2829  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3020        181        250         99        193        216        185 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       158        332        477        735        194 
Trial 13 done!
******************
***************
Doing now trial 14 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 249   Min.   : 612   Min.   : 929   Min.   : 882  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2109   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3336   Max.   :2993   Max.   :2760   Max.   :2790  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3081        216        208         75        171        226        157 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        291        632        757        194 
Trial 14 done!
******************
***************
Doing now trial 15 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   4   Min.   : 543   Min.   :1090   Min.   : 853  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3483   Max.   :2977   Max.   :2694   Max.   :2833  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2968        173        195         87        186        218        178 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       150        328        500        796        157 
Trial 15 done!
******************
***************
Doing now trial 16 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 346   Min.   : 807   Min.   : 996   Min.   : 810  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3429   Max.   :2884   Max.   :2685   Max.   :2679  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2867         97        138         93        136        155        266 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       153        291        606        759        173 
Trial 16 done!
******************
***************
Doing now trial 17 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 494   Min.   : 521   Min.   : 997   Min.   : 841  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3364   Max.   :2978   Max.   :2794   Max.   :2826  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2908        124        168        128        146        191        196 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       191        341        554        692        177 
Trial 17 done!
******************
***************
Doing now trial 18 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 411   Min.   : 576   Min.   : 875   Min.   : 897  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3406   Max.   :2974   Max.   :2800   Max.   :2821  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2889        144        164        128        159        192        213 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       167        264        598        688        172 
Trial 18 done!
******************
***************
Doing now trial 19 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 404   Min.   : 119   Min.   : 702   Min.   : 966  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3351   Max.   :3251   Max.   :2856   Max.   :2789  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2770        139        167        110        128        196        220 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        259        572        669        156 
Trial 19 done!
******************
***************
Doing now trial 20 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 525   Min.   :   0   Min.   : 898   Min.   : 961  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2058   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2099   3rd Qu.:2106  
 Max.   :4073   Max.   :4072   Max.   :4073   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3073        145        182        149        120        243        218 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       129        358        649        696        184 
Trial 20 done!
******************
***************
Doing now trial 21 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 447   Min.   : 932   Min.   : 871  
 1st Qu.:2008   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3555   Max.   :2976   Max.   :2752   Max.   :2780  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3062        145        150         91        127        206        284 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       141        231        705        778        204 
Trial 21 done!
******************
***************
Doing now trial 22 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 288   Min.   : 900   Min.   : 929   Min.   : 899  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3403   Max.   :2893   Max.   :2723   Max.   :2799  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2712        104        171        116        133        163        216 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       132        236        588        701        152 
Trial 22 done!
******************
***************
Doing now trial 23 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 453   Min.   : 912   Min.   :1084   Min.   : 805  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3426   Max.   :2959   Max.   :2729   Max.   :2960  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2733        104        138         67        107        161        282 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       135        202        655        695        187 
Trial 23 done!
******************
***************
Doing now trial 24 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  59   Min.   : 369   Min.   : 905   Min.   : 750  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3760   Max.   :3000   Max.   :2834   Max.   :2707  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2745        140        146        119        130        186        225 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       170        272        505        685        167 
Trial 24 done!
******************
***************
Doing now trial 25 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 512   Min.   : 498   Min.   : 639   Min.   : 934  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3369   Max.   :3035   Max.   :2868   Max.   :2797  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2852        149        183        169        120        184        153 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       129        293        622        683        167 
Trial 25 done!
******************
***************
Doing now trial 26 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 632   Min.   : 602   Min.   :1040   Min.   : 897  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3355   Max.   :2948   Max.   :2769   Max.   :2816  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2717        108        149         85         94        163        207 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       133        297        646        676        159 
Trial 26 done!
******************
***************
Doing now trial 27 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 414   Min.   : 551   Min.   :1079   Min.   : 829  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2016   1st Qu.:2012  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3480   Max.   :2912   Max.   :2679   Max.   :2866  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2712        131        179        104        115        175        233 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       123        281        596        625        150 
Trial 27 done!
******************
***************
Doing now trial 28 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  68   Min.   : 650   Min.   :1257   Min.   : 781  
 1st Qu.:2011   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2100   3rd Qu.:2097   3rd Qu.:2103  
 Max.   :3437   Max.   :2976   Max.   :2635   Max.   :2864  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2633        124        115         61         87        154        243 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       137        205        661        650        196 
Trial 28 done!
******************
***************
Doing now trial 29 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   6   Min.   : 240   Min.   :1198   Min.   : 959  
 1st Qu.:2009   1st Qu.:2013   1st Qu.:2016   1st Qu.:2013  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2055   Mean   :2055   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3789   Max.   :3187   Max.   :2739   Max.   :2703  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2717        142        167         80        101        155        216 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        261        584        699        158 
Trial 29 done!
******************
***************
Doing now trial 30 of Spontaneous_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 533   Min.   : 890   Min.   :1224   Min.   : 680  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2016   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3487   Max.   :3142   Max.   :2784   Max.   :2874  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2722         99        152         70        111        169        263 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        228        644        654        178 
Trial 30 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: Spontaneous_4-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file Spontaneous_4-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_Spontaneous_4_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 30 trials of =Spontaneous_4= for tetrodeB.
#+RESULTS: Spontaneous_4-count-evolution-tetB
[[file:locust20010214_tetB_fig/Spontaneous_4-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: Spontaneous_4-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file Spontaneous_4-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_Spontaneous_4_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 30 trials of =Spontaneous_4= for tetrodeB.
#+RESULTS: Spontaneous_4-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/Spontaneous_4-waveform-evolution-tetB.png]]

The observed counting processes and inter spike intervals densities are:

#+NAME: Spontaneous_4-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file Spontaneous_4-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi(a_Spontaneous_4_tetB,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for =Spontaneous_4=.
#+RESULTS: Spontaneous_4-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/Spontaneous_4-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: Spontaneous_4-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file Spontaneous_4-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_Spontaneous_4_tetB$spike_trains[[i]],
                    a_Spontaneous_4_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: Spontaneous_4-rt-test-tetB
[[file:locust20010214_tetB_fig/Spontaneous_4-rt-test-tetB.png]]

** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-Spontaneous_4
#+BEGIN_SRC R :session *R* :results silent
save(a_Spontaneous_4_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_Spontaneous_4_tetB$spike_trains))
    if (!is.null(a_Spontaneous_4_tetB$spike_trains[[c_idx]]))
        cat(a_Spontaneous_4_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_Spontaneous_4_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC


* 30 trials of =C3H_3=

** Do the job

#+NAME: C3H_3-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "C3H_3"
a_C3H_3_tetB=sort_many_trials(inter_trial_time=30*15000,
                              get_data_fct=get_tetrode_data,
                              stim_name=stim_name,
                              trial_nbs=1:30,
                              centers=a_Spontaneous_4_tetB$centers,
                              counts=a_Spontaneous_4_tetB$counts,
                              all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                         filter_length_1=filter_length, filter_length=filter_length, 
                                                         minimalDist_1=15, minimalDist=15, 
                                                         before=c_before, after=c_after, 
                                                         detection_cycle=c(0,0), verbose=1),
                              layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                              )
#+END_SRC

#+RESULTS: C3H_3-tetB
#+begin_example
***************
Doing now trial 1 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 561   Min.   : 595   Min.   :1167   Min.   : 905  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3702   Max.   :2926   Max.   :2759   Max.   :2851  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2974        190        197         80        116        194        244 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       150        240        605        776        182 
Trial 1 done!
******************
***************
Doing now trial 2 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 343   Min.   : 660   Min.   : 956   Min.   : 877  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3462   Max.   :2996   Max.   :2842   Max.   :2847  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2922        187        169         71         82        205        246 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       140        321        570        750        181 
Trial 2 done!
******************
***************
Doing now trial 3 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 698   Min.   : 797   Min.   :1083   Min.   : 984  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3364   Max.   :2881   Max.   :2751   Max.   :2774  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2700        182        192         80         74        191        246 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       178        210        515        659        173 
Trial 3 done!
******************
***************
Doing now trial 4 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 145   Min.   : 915   Min.   :1146   Min.   : 802  
 1st Qu.:2010   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3422   Max.   :2956   Max.   :2768   Max.   :2786  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2657        137        158         51         89        147        244 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       150        256        601        645        179 
Trial 4 done!
******************
***************
Doing now trial 5 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 283   Min.   : 556   Min.   :1117   Min.   : 621  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3569   Max.   :3010   Max.   :2693   Max.   :2842  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2743        172        134         65         91        210        266 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       152        226        572        673        182 
Trial 5 done!
******************
***************
Doing now trial 6 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 170   Min.   : 703   Min.   :1009   Min.   : 934  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3393   Max.   :2934   Max.   :2718   Max.   :2827  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2638        160        164         59         63        192        226 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       153        224        578        638        181 
Trial 6 done!
******************
***************
Doing now trial 7 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 669   Min.   : 534   Min.   :1163   Min.   : 844  
 1st Qu.:2010   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2103  
 Max.   :3475   Max.   :3080   Max.   :2668   Max.   :2742  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2569        126        152         49         51        198        227 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       142        265        612        589        158 
Trial 7 done!
******************
***************
Doing now trial 8 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 729   Min.   : 662   Min.   :1182   Min.   :1044  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2054   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3442   Max.   :2950   Max.   :2801   Max.   :2805  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2682        154        160         59         77        147        255 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       139        248        615        660        168 
Trial 8 done!
******************
***************
Doing now trial 9 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 598   Min.   : 441   Min.   : 972   Min.   : 907  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3687   Max.   :3040   Max.   :2747   Max.   :2837  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2775        167        175         61        107        220        215 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       155        254        580        660        181 
Trial 9 done!
******************
***************
Doing now trial 10 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   :   0   Min.   : 399   Min.   : 568  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2058   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :4073   Max.   :4073   Max.   :4072   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2797        152        166        103         66        221        287 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       144        293        614        586        165 
Trial 10 done!
******************
***************
Doing now trial 11 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 642   Min.   : 784   Min.   : 797  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2010  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2099   3rd Qu.:2105  
 Max.   :3658   Max.   :2931   Max.   :2762   Max.   :2794  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3146        168        127        106        107        235        306 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       113        274        772        701        237 
Trial 11 done!
******************
***************
Doing now trial 12 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 685   Min.   : 993   Min.   : 966  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3527   Max.   :2914   Max.   :2830   Max.   :2782  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2870        163        181        104         78        189        258 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       145        276        592        712        172 
Trial 12 done!
******************
***************
Doing now trial 13 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 577   Min.   : 680   Min.   : 975   Min.   : 804  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2104  
 Max.   :3594   Max.   :3055   Max.   :2794   Max.   :2910  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2839        137        144        112        117        214        229 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       140        267        673        648        158 
Trial 13 done!
******************
***************
Doing now trial 14 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 530   Min.   : 516   Min.   : 932   Min.   : 845  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3560   Max.   :2960   Max.   :2730   Max.   :2801  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2708        183        153         75         85        172        262 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       149        292        579        614        144 
Trial 14 done!
******************
***************
Doing now trial 15 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 581   Min.   : 673   Min.   : 942   Min.   : 811  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3378   Max.   :2892   Max.   :2843   Max.   :2856  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2689        137        158         56         77        203        248 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        230        630        648        141 
Trial 15 done!
******************
***************
Doing now trial 16 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 589   Min.   : 808   Min.   : 993   Min.   : 831  
 1st Qu.:2010   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2103  
 Max.   :3419   Max.   :2893   Max.   :2844   Max.   :2825  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2704        110        144         67         71        190        244 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       126        230        716        638        168 
Trial 16 done!
******************
***************
Doing now trial 17 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 703   Min.   : 869   Min.   :1170   Min.   :1007  
 1st Qu.:2010   1st Qu.:2013   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2104   3rd Qu.:2100   3rd Qu.:2097   3rd Qu.:2103  
 Max.   :3403   Max.   :2961   Max.   :2728   Max.   :2793  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2542        116        133         55         49        143        299 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       134        187        633        629        164 
Trial 17 done!
******************
***************
Doing now trial 18 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 146   Min.   : 872   Min.   :1129   Min.   : 944  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2103  
 Max.   :3398   Max.   :2878   Max.   :2786   Max.   :2794  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2612        136        133         69         66        167        231 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       122        260        640        611        177 
Trial 18 done!
******************
***************
Doing now trial 19 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 571   Min.   : 952   Min.   : 935  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3718   Max.   :3048   Max.   :2837   Max.   :2887  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2732        160        140         79        119        201        273 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       125        260        601        623        151 
Trial 19 done!
******************
***************
Doing now trial 20 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  10   Min.   :   0   Min.   : 646   Min.   : 836  
 1st Qu.:2008   1st Qu.:2010   1st Qu.:2014   1st Qu.:2010  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2054  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :4073   Max.   :4072   Max.   :4073   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2847        161        134         81        115        213        310 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       134        338        634        572        155 
Trial 20 done!
******************
***************
Doing now trial 21 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 574   Min.   :1051   Min.   : 988  
 1st Qu.:2007   1st Qu.:2010   1st Qu.:2013   1st Qu.:2009  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2054  
 3rd Qu.:2109   3rd Qu.:2104   3rd Qu.:2099   3rd Qu.:2107  
 Max.   :3831   Max.   :3161   Max.   :2743   Max.   :2803  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3143        201        211         69        147        215        328 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       132        247        664        764        165 
Trial 21 done!
******************
***************
Doing now trial 22 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 591   Min.   : 628   Min.   : 931   Min.   : 966  
 1st Qu.:2007   1st Qu.:2010   1st Qu.:2014   1st Qu.:2010  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2054  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3633   Max.   :3020   Max.   :2860   Max.   :2882  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2878        177        184         89        151        176        245 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       163        256        618        667        152 
Trial 22 done!
******************
***************
Doing now trial 23 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 451   Min.   : 508   Min.   : 961   Min.   : 755  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2014   1st Qu.:2010  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3424   Max.   :3077   Max.   :3140   Max.   :3169  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2981        180        184         90        135        217        259 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        271        620        683        181 
Trial 23 done!
******************
***************
Doing now trial 24 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 582   Min.   : 457   Min.   : 871   Min.   : 794  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2010  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3368   Max.   :3010   Max.   :2941   Max.   :2856  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2858        204        165        123         86        234        242 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       137        254        549        702        162 
Trial 24 done!
******************
***************
Doing now trial 25 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 467   Min.   : 575   Min.   :1010   Min.   : 929  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3348   Max.   :3022   Max.   :2762   Max.   :3111  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2670        146        165         80         69        175        267 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       148        272        577        612        159 
Trial 25 done!
******************
***************
Doing now trial 26 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 606   Min.   : 676   Min.   :1044   Min.   : 984  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3377   Max.   :2940   Max.   :2899   Max.   :3013  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2788        117        197         93        108        226        256 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       158        284        555        654        140 
Trial 26 done!
******************
***************
Doing now trial 27 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  41   Min.   : 640   Min.   : 908   Min.   : 944  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2104  
 Max.   :3602   Max.   :3002   Max.   :2743   Max.   :2838  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2805        128        174         64        125        165        307 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       156        260        671        602        153 
Trial 27 done!
******************
***************
Doing now trial 28 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   9   Min.   : 439   Min.   : 809   Min.   : 925  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3695   Max.   :2934   Max.   :2856   Max.   :2756  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2791        161        166         71         92        234        252 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       158        326        548        643        140 
Trial 28 done!
******************
***************
Doing now trial 29 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 191   Min.   : 747   Min.   :1013   Min.   : 848  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3419   Max.   :2961   Max.   :2740   Max.   :2882  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2774        156        173         87         66        227        234 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       137        311        577        644        162 
Trial 29 done!
******************
***************
Doing now trial 30 of C3H_3
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 643   Min.   : 804   Min.   : 843  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3688   Max.   :2951   Max.   :2819   Max.   :2949  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2776        135        160         58        150        150        270 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       132        290        650        616        165 
Trial 30 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: C3H_3-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file C3H_3-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_C3H_3_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 30 trials of =C3H_3= for tetrodeB.
#+RESULTS: C3H_3-count-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_3-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: C3H_3-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file C3H_3-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_C3H_3_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 30 trials of =C3H_3= for tetrodeB.
#+RESULTS: C3H_3-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_3-waveform-evolution-tetB.png]]

The observed counting processes and inter spike intervals densities are:

#+NAME: C3H_3-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file C3H_3-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi_raster(a_C3H_3_tetB,inter_trial_time=30,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for =C3H_3=.
#+RESULTS: C3H_3-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/C3H_3-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: C3H_3-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file C3H_3-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_C3H_3_tetB$spike_trains[[i]],
                    a_C3H_3_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: C3H_3-rt-test-tetB
[[file:locust20010214_tetB_fig/C3H_3-rt-test-tetB.png]]

** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-C3H_3
#+BEGIN_SRC R :session *R* :results silent
save(a_C3H_3_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_C3H_3_tetB$spike_trains))
    if (!is.null(a_C3H_3_tetB$spike_trains[[c_idx]]))
        cat(a_C3H_3_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_C3H_3_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC


* 10 trials of =C3H_4=

The =LabBook= mentions that the disk got filled up during trial 11 (30 were planed ) so we stop at trial 10.
 
** Do the job

#+NAME: C3H_4-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "C3H_4"
a_C3H_4_tetB=sort_many_trials(inter_trial_time=30*15000,
                              get_data_fct=get_tetrode_data,
                              stim_name=stim_name,
                              trial_nbs=1:10,
                              centers=a_C3H_3_tetB$centers,
                              counts=a_C3H_3_tetB$counts,
                              all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                         filter_length_1=filter_length, filter_length=filter_length, 
                                                         minimalDist_1=15, minimalDist=15, 
                                                         before=c_before, after=c_after, 
                                                         detection_cycle=c(0,0), verbose=1),
                              layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                              )
#+END_SRC


#+RESULTS: C3H_4-tetB
#+begin_example
***************
Doing now trial 1 of C3H_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 582   Min.   :1039   Min.   : 742  
 1st Qu.:2007   1st Qu.:2011   1st Qu.:2014   1st Qu.:2010  
 Median :2058   Median :2058   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3567   Max.   :2953   Max.   :2735   Max.   :2760  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      3154        153        157         90        148        181        294 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       180        310        752        691        198 
Trial 1 done!
******************
***************
Doing now trial 2 of C3H_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  23   Min.   : 455   Min.   :1114   Min.   : 787  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3617   Max.   :2999   Max.   :2762   Max.   :2851  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2765        153        177         89         83        119        348 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       160        232        636        622        146 
Trial 2 done!
******************
***************
Doing now trial 3 of C3H_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 484   Min.   : 728   Min.   :1155   Min.   : 833  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3446   Max.   :2924   Max.   :2717   Max.   :2907  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2576        116        112         50        116        146        261 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       159        213        644        619        140 
Trial 3 done!
******************
***************
Doing now trial 4 of C3H_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 738   Min.   : 560   Min.   : 945   Min.   : 836  
 1st Qu.:2010   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2104   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3348   Max.   :2996   Max.   :2807   Max.   :2862  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2405        128        134         55         67        124        259 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       146        206        586        565        135 
Trial 4 done!
******************
***************
Doing now trial 5 of C3H_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 113   Min.   : 478   Min.   :1126   Min.   : 903  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3734   Max.   :3014   Max.   :2743   Max.   :2844  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2850        133        140         76         91        280        233 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       150        339        606        639        163 
Trial 5 done!
******************
***************
Doing now trial 6 of C3H_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 659   Min.   : 627   Min.   : 937   Min.   : 911  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3342   Max.   :3020   Max.   :2817   Max.   :2865  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2675        175        191         95         89        214        225 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       135        284        505        618        144 
Trial 6 done!
******************
***************
Doing now trial 7 of C3H_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 396   Min.   : 624   Min.   :1089   Min.   : 846  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3545   Max.   :3002   Max.   :2783   Max.   :2933  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2662        128        148         80        131        136        264 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       144        222        615        629        165 
Trial 7 done!
******************
***************
Doing now trial 8 of C3H_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 707   Min.   : 469   Min.   :1125   Min.   : 799  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3293   Max.   :2925   Max.   :2765   Max.   :2967  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2607        155        146         53        116        169        273 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       160        238        552        591        154 
Trial 8 done!
******************
***************
Doing now trial 9 of C3H_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 142   Min.   : 697   Min.   : 955   Min.   : 726  
 1st Qu.:2007   1st Qu.:2010   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2106  
 Max.   :3561   Max.   :2898   Max.   :2775   Max.   :2787  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2839        190        188        101        108        253        220 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        335        477        653        160 
Trial 9 done!
******************
***************
Doing now trial 10 of C3H_4
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 196   Min.   :   0   Min.   : 772   Min.   : 791  
 1st Qu.:2008   1st Qu.:2010   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :4073   Max.   :4072   Max.   :4073   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2753        137        142        107         74        201        276 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       142        296        663        560        155 
Trial 10 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: C3H_4-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file C3H_4-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_C3H_4_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 10 trials of =C3H_4= for tetrodeB.
#+RESULTS: C3H_4-count-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_4-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: C3H_4-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file C3H_4-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_C3H_4_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 10 trials of =C3H_4= for tetrodeB.
#+RESULTS: C3H_4-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_4-waveform-evolution-tetB.png]]

The observed counting processes and inter spike intervals densities are:

#+NAME: C3H_4-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file C3H_4-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi_raster(a_C3H_4_tetB,inter_trial_time=30,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for =C3H_4=.
#+RESULTS: C3H_4-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/C3H_4-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: C3H_4-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file C3H_4-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_C3H_4_tetB$spike_trains[[i]],
                    a_C3H_4_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: C3H_4-rt-test-tetB
[[file:locust20010214_tetB_fig/C3H_4-rt-test-tetB.png]]


** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-C3H_4
#+BEGIN_SRC R :session *R* :results silent
save(a_C3H_4_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_C3H_4_tetB$spike_trains))
    if (!is.null(a_C3H_4_tetB$spike_trains[[c_idx]]))
        cat(a_C3H_4_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_C3H_4_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC


* 30 trials of =C3H_5=

The =LabBook= mentions noise in trials 21, 22 and 23 so we do not consider them.

** Do the job

#+NAME: C3H_5-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "C3H_5"
a_C3H_5_tetB=sort_many_trials(inter_trial_time=30*15000,
                              get_data_fct=get_tetrode_data,
                              stim_name=stim_name,
                              trial_nbs=c(1:20,24:30),
                              centers=a_C3H_4_tetB$centers,
                              counts=a_C3H_4_tetB$counts,
                              all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                         filter_length_1=filter_length, filter_length=filter_length, 
                                                         minimalDist_1=15, minimalDist=15, 
                                                         before=c_before, after=c_after, 
                                                         detection_cycle=c(0,0), verbose=1),
                              layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                              )
#+END_SRC

#+RESULTS: C3H_5-tetB
#+begin_example
***************
Doing now trial 1 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 545   Min.   : 799   Min.   :1079   Min.   : 775  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3453   Max.   :2923   Max.   :2758   Max.   :3129  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2810        131        137         83         79        150        356 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       160        223        752        576        163 
Trial 1 done!
******************
***************
Doing now trial 2 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 353   Min.   :  54   Min.   : 682   Min.   : 809  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2056   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3374   Max.   :3066   Max.   :2900   Max.   :2784  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2688        142        183        115         98        152        278 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        204        588        610        157 
Trial 2 done!
******************
***************
Doing now trial 3 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 607   Min.   : 979   Min.   : 841  
 1st Qu.:2008   1st Qu.:2010   1st Qu.:2014   1st Qu.:2010  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2054  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2099   3rd Qu.:2106  
 Max.   :3815   Max.   :3057   Max.   :2734   Max.   :2825  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2847        185        170        180        105        208        276 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       180        263        542        602        136 
Trial 3 done!
******************
***************
Doing now trial 4 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 565   Min.   : 534   Min.   : 844   Min.   : 885  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2099   3rd Qu.:2105  
 Max.   :3375   Max.   :2952   Max.   :2851   Max.   :2822  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2717        161        203        198         76        200        225 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       170        258        531        557        138 
Trial 4 done!
******************
***************
Doing now trial 5 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 390   Min.   : 506   Min.   : 914   Min.   :1038  
 1st Qu.:2007   1st Qu.:2009   1st Qu.:2013   1st Qu.:2010  
 Median :2059   Median :2058   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2054  
 3rd Qu.:2109   3rd Qu.:2105   3rd Qu.:2100   3rd Qu.:2107  
 Max.   :3495   Max.   :3039   Max.   :2769   Max.   :2740  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2954        201        186        270         99        279        222 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       148        346        462        600        141 
Trial 5 done!
******************
***************
Doing now trial 6 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 502   Min.   : 289   Min.   : 768   Min.   : 983  
 1st Qu.:2008   1st Qu.:2010   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3407   Max.   :3047   Max.   :2884   Max.   :2861  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2723        170        193        158        126        183        251 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       134        265        539        569        135 
Trial 6 done!
******************
***************
Doing now trial 7 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 675   Min.   : 502   Min.   : 976   Min.   : 813  
 1st Qu.:2008   1st Qu.:2010   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3327   Max.   :3092   Max.   :2768   Max.   :2756  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2737        179        172        143         79        265        197 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       160        321        439        644        138 
Trial 7 done!
******************
***************
Doing now trial 8 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 691   Min.   : 462   Min.   : 854   Min.   : 712  
 1st Qu.:2008   1st Qu.:2010   1st Qu.:2014   1st Qu.:2010  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2099   3rd Qu.:2106  
 Max.   :3308   Max.   :3062   Max.   :2821   Max.   :3016  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2844        158        201        125        105        255        260 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       136        239        575        624        166 
Trial 8 done!
******************
***************
Doing now trial 9 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   :  96   Min.   : 706   Min.   : 859   Min.   : 762  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3459   Max.   :2970   Max.   :2835   Max.   :2885  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2706        173        156        133        120        151        227 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       150        257        629        564        146 
Trial 9 done!
******************
***************
Doing now trial 10 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   :   0   Min.   :   0   Min.   :   0  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2010  
 Median :2058   Median :2058   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2104   3rd Qu.:2099   3rd Qu.:2106  
 Max.   :4073   Max.   :4073   Max.   :4072   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2833        138        195        183        114        229        204 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       121        325        577        603        144 
Trial 10 done!
******************
***************
Doing now trial 11 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 431   Min.   : 910   Min.   : 786  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2099   3rd Qu.:2105  
 Max.   :3670   Max.   :3099   Max.   :2816   Max.   :2820  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2866        176        191        143         67        166        273 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       130        305        652        596        167 
Trial 11 done!
******************
***************
Doing now trial 12 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 576   Min.   : 600   Min.   : 925   Min.   : 849  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2104  
 Max.   :3470   Max.   :3026   Max.   :2757   Max.   :2771  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2769        136        171         82         84        170        270 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       133        211        715        670        127 
Trial 12 done!
******************
***************
Doing now trial 13 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 560   Min.   : 593   Min.   :1171   Min.   : 772  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3436   Max.   :2897   Max.   :2828   Max.   :2939  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2730        145        172         84         61        145        250 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        236        665        644        167 
Trial 13 done!
******************
***************
Doing now trial 14 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 630   Min.   : 623   Min.   :1053   Min.   : 709  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3514   Max.   :2878   Max.   :2794   Max.   :2825  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2730        157        155         95         93        184        285 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        271        605        574        150 
Trial 14 done!
******************
***************
Doing now trial 15 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 381   Min.   : 519   Min.   : 809   Min.   :1028  
 1st Qu.:2008   1st Qu.:2010   1st Qu.:2014   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2108   3rd Qu.:2103   3rd Qu.:2099   3rd Qu.:2106  
 Max.   :3761   Max.   :2972   Max.   :2861   Max.   :2861  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2873        169        212        119        109        172        245 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       193        286        619        601        148 
Trial 15 done!
******************
***************
Doing now trial 16 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 495   Min.   : 569   Min.   :1080   Min.   : 836  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3430   Max.   :2992   Max.   :2770   Max.   :2730  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2692        140        188         70         99        153        267 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       160        234        631        596        154 
Trial 16 done!
******************
***************
Doing now trial 17 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 392   Min.   : 382   Min.   : 865   Min.   : 849  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3416   Max.   :2963   Max.   :2761   Max.   :2874  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2765        192        187         94         93        203        217 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       152        303        497        684        143 
Trial 17 done!
******************
***************
Doing now trial 18 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 590   Min.   : 816   Min.   :1131   Min.   : 901  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2104  
 Max.   :3365   Max.   :3005   Max.   :2739   Max.   :2754  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2676        171        173         64         83        216        223 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       135        283        565        640        123 
Trial 18 done!
******************
***************
Doing now trial 19 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 430   Min.   : 422   Min.   : 828   Min.   : 843  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2056   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3431   Max.   :3031   Max.   :2908   Max.   :2858  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2691        165        175         83        112        192        222 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       147        272        544        647        132 
Trial 19 done!
******************
***************
Doing now trial 20 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   :   0   Min.   :   0   Min.   :   0  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2058   Median :2056   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2103   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :4073   Max.   :4073   Max.   :4073   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2631        131        142         77         87        191        261 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       164        307        553        605        113 
Trial 20 done!
******************
***************
Doing now trial 24 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 135   Min.   : 468   Min.   :1092   Min.   : 717  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3309   Max.   :2996   Max.   :2673   Max.   :2774  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2660        124        159         80        110        230        250 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       149        228        594        594        142 
Trial 24 done!
******************
***************
Doing now trial 25 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 511   Min.   : 727   Min.   : 937   Min.   : 920  
 1st Qu.:2010   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2056   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3269   Max.   :2962   Max.   :2689   Max.   :2734  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2590        146        167         58         60        163        318 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       146        183        606        623        120 
Trial 25 done!
******************
***************
Doing now trial 26 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 626   Min.   :1144   Min.   : 989  
 1st Qu.:2010   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2104   3rd Qu.:2100   3rd Qu.:2096   3rd Qu.:2103  
 Max.   :3464   Max.   :2994   Max.   :2704   Max.   :2759  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2436        128        197         42         93        100        279 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       147        184        615        518        133 
Trial 26 done!
******************
***************
Doing now trial 27 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 534   Min.   : 696   Min.   : 883   Min.   : 963  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2103  
 Max.   :3374   Max.   :2966   Max.   :2853   Max.   :2785  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2493        139        154         53         80        232        245 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       144        221        558        545        122 
Trial 27 done!
******************
***************
Doing now trial 28 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 696   Min.   :1146   Min.   : 958  
 1st Qu.:2010   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2056   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2104   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2103  
 Max.   :3581   Max.   :3020   Max.   :2700   Max.   :2767  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2518        143        174         66         74        115        284 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       116        223        641        564        118 
Trial 28 done!
******************
***************
Doing now trial 29 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 645   Min.   : 531   Min.   : 909   Min.   : 832  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2103  
 Max.   :3303   Max.   :2998   Max.   :2855   Max.   :2709  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2452        192        159         52        102        134        256 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       130        228        545        531        123 
Trial 29 done!
******************
***************
Doing now trial 30 of C3H_5
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 663   Min.   : 655   Min.   :1095   Min.   : 823  
 1st Qu.:2008   1st Qu.:2010   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3381   Max.   :2940   Max.   :2851   Max.   :2917  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2751        181        219        140        115        222        247 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       150        299        519        529        130 
Trial 30 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: C3H_5-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file C3H_5-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_C3H_5_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 27 trials of =C3H_5= for tetrodeB.
#+RESULTS: C3H_5-count-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_5-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: C3H_5-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file C3H_5-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_C3H_5_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 27 trials of =C3H_5= for tetrodeB.
#+RESULTS: C3H_5-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_5-waveform-evolution-tetB.png]]

The observed counting processes and inter spike intervals densities are:

#+NAME: C3H_5-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file C3H_5-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi_raster(a_C3H_5_tetB,inter_trial_time=30,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for =C3H_5=.
#+RESULTS: C3H_5-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/C3H_5-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: C3H_5-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file C3H_5-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_C3H_5_tetB$spike_trains[[i]],
                    a_C3H_5_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: C3H_5-rt-test-tetB
[[file:locust20010214_tetB_fig/C3H_5-rt-test-tetB.png]]


** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-C3H_5
#+BEGIN_SRC R :session *R* :results silent
save(a_C3H_5_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_C3H_5_tetB$spike_trains))
    if (!is.null(a_C3H_5_tetB$spike_trains[[c_idx]]))
        cat(a_C3H_5_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_C3H_5_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC


* 30 trials of =C3H_6=

** Do the job

#+NAME: C3H_6-tetB
#+BEGIN_SRC R :exports code :results output :session *R*
stim_name = "C3H_6"
a_C3H_6_tetB=sort_many_trials(inter_trial_time=30*15000,
                              get_data_fct=get_tetrode_data,
                              stim_name=stim_name,
                              trial_nbs=1:30,
                              centers=a_C3H_5_tetB$centers,
                              counts=a_C3H_5_tetB$counts,
                              all_at_once_call_list=list(thres=threshold_factor*c(1,1,1,1), 
                                                         filter_length_1=filter_length, filter_length=filter_length, 
                                                         minimalDist_1=15, minimalDist=15, 
                                                         before=c_before, after=c_after, 
                                                         detection_cycle=c(0,0), verbose=1),
                              layout_matrix=matrix(c(1,1:11),nr=6),new_weight_in_update=0.01
                              )
#+END_SRC

#+RESULTS: C3H_6-tetB
#+begin_example
***************
Doing now trial 1 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 581   Min.   : 907   Min.   : 667  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3573   Max.   :3034   Max.   :2789   Max.   :2847  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2840        165        158        107         63        162        327 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       153        249        672        625        159 
Trial 1 done!
******************
***************
Doing now trial 2 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 632   Min.   : 505   Min.   : 922   Min.   : 767  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3411   Max.   :3063   Max.   :2804   Max.   :2835  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2798        199        208        105         82        200        265 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       128        283        586        603        139 
Trial 2 done!
******************
***************
Doing now trial 3 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 249   Min.   : 774   Min.   : 923   Min.   :1035  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3339   Max.   :2881   Max.   :2740   Max.   :2823  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2724        179        197        137        117        179        237 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       148        283        523        564        160 
Trial 3 done!
******************
***************
Doing now trial 4 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 623   Min.   : 870   Min.   : 932   Min.   :1047  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3266   Max.   :2915   Max.   :2810   Max.   :2847  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2641        144        187        107         88        194        242 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       161        263        555        558        142 
Trial 4 done!
******************
***************
Doing now trial 5 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 594   Min.   : 884   Min.   :1076   Min.   : 849  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3449   Max.   :2931   Max.   :2718   Max.   :2831  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2711        152        171         66        130        177        277 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       164        241        604        574        155 
Trial 5 done!
******************
***************
Doing now trial 6 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 615   Min.   : 425   Min.   : 969   Min.   : 974  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3251   Max.   :2996   Max.   :2795   Max.   :2961  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2584        156        166         84         84        172        250 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       157        249        579        528        159 
Trial 6 done!
******************
***************
Doing now trial 7 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 419   Min.   : 596   Min.   :1163   Min.   : 715  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3429   Max.   :3118   Max.   :2669   Max.   :2739  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2565        188        179         56         83        179        254 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       166        235        578        506        141 
Trial 7 done!
******************
***************
Doing now trial 8 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 477   Min.   : 820   Min.   :1138   Min.   : 873  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3464   Max.   :2918   Max.   :2877   Max.   :2919  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2583        155        189         78         61        160        232 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       180        254        571        553        150 
Trial 8 done!
******************
***************
Doing now trial 9 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 216   Min.   : 738   Min.   :1234   Min.   :1011  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2104  
 Max.   :3676   Max.   :2992   Max.   :2722   Max.   :2856  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2634        185        181        112         72        221        229 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        300        577        474        129 
Trial 9 done!
******************
***************
Doing now trial 10 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 469   Min.   :   0   Min.   :1078   Min.   : 854  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :4073   Max.   :4073   Max.   :4073   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2596        154        183        105         96        200        256 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       178        267        538        476        143 
Trial 10 done!
******************
***************
Doing now trial 11 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 461   Min.   : 802   Min.   :1021   Min.   :1025  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2058  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3468   Max.   :2929   Max.   :2790   Max.   :2833  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2716        160        152         70        100        148        336 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       149        195        672        570        164 
Trial 11 done!
******************
***************
Doing now trial 12 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 315   Min.   : 514   Min.   :1064   Min.   : 971  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3448   Max.   :2914   Max.   :2693   Max.   :2783  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2741        183        170         85         90        180        265 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       169        252        646        556        145 
Trial 12 done!
******************
***************
Doing now trial 13 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 639   Min.   : 434   Min.   :1061   Min.   : 853  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3307   Max.   :2963   Max.   :2752   Max.   :2765  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2766        155        186         78        104        199        288 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       157        248        605        601        145 
Trial 13 done!
******************
***************
Doing now trial 14 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 339   Min.   : 779   Min.   : 786  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3495   Max.   :3083   Max.   :2886   Max.   :2732  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2618        182        170         80         76        198        235 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       149        257        564        572        135 
Trial 14 done!
******************
***************
Doing now trial 15 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 489   Min.   : 432   Min.   :1108   Min.   :1054  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2056   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3441   Max.   :2987   Max.   :2766   Max.   :2755  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2603        120        158         74        108        207        255 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       145        255        553        599        129 
Trial 15 done!
******************
***************
Doing now trial 16 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 743   Min.   : 421   Min.   : 916   Min.   : 900  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2056   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3491   Max.   :3060   Max.   :2820   Max.   :2856  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2618        147        185         87         68        192        240 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       158        277        554        547        163 
Trial 16 done!
******************
***************
Doing now trial 17 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 364   Min.   : 664   Min.   :1095   Min.   :1082  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2056   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3226   Max.   :2885   Max.   :2780   Max.   :2688  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2555        139        184        100         61        165        285 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       169        273        551        493        135 
Trial 17 done!
******************
***************
Doing now trial 18 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 585   Min.   : 712   Min.   :1097   Min.   : 913  
 1st Qu.:2010   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2103  
 Max.   :3344   Max.   :2997   Max.   :2773   Max.   :2765  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2484        158        159         77         79        152        270 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       154        193        597        493        152 
Trial 18 done!
******************
***************
Doing now trial 19 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 721   Min.   : 766   Min.   :1091   Min.   :1077  
 1st Qu.:2010   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2103  
 Max.   :3265   Max.   :2905   Max.   :2671   Max.   :2805  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2469        136        163         73         81        193        237 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       152        210        549        539        136 
Trial 19 done!
******************
***************
Doing now trial 20 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   :  13   Min.   : 830   Min.   : 750  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :4072   Max.   :4072   Max.   :4072   Max.   :4072  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2646        160        160         81         84        185        267 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       136        306        590        533        144 
Trial 20 done!
******************
***************
Doing now trial 21 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   0   Min.   : 590   Min.   : 930   Min.   : 919  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3728   Max.   :3185   Max.   :2967   Max.   :2909  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2856        167        160         77         98        198        312 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       160        308        676        539        161 
Trial 21 done!
******************
***************
Doing now trial 22 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 198   Min.   : 375   Min.   : 969   Min.   : 871  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2010  
 Median :2059   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2103   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3385   Max.   :3070   Max.   :2808   Max.   :2933  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2938        191        175         73        110        199        296 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       177        268        624        639        186 
Trial 22 done!
******************
***************
Doing now trial 23 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   :   5   Min.   : 619   Min.   : 833   Min.   : 816  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3426   Max.   :2921   Max.   :2882   Max.   :2797  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2627        150        150         60         89        160        292 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       170        223        599        578        156 
Trial 23 done!
******************
***************
Doing now trial 24 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 137   Min.   : 632   Min.   : 983   Min.   : 873  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2056   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3735   Max.   :3008   Max.   :2756   Max.   :2850  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2737        180        200         75        124        211        238 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       160        298        507        617        127 
Trial 24 done!
******************
***************
Doing now trial 25 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 400   Min.   : 563   Min.   :1067   Min.   : 792  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2059   Median :2057   Median :2056   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2097   3rd Qu.:2105  
 Max.   :3624   Max.   :2980   Max.   :2811   Max.   :2777  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2717        170        203         69        103        166        274 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       156        249        517        627        183 
Trial 25 done!
******************
***************
Doing now trial 26 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 492   Min.   : 727   Min.   :1116   Min.   : 983  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2012  
 Median :2058   Median :2057   Median :2056   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3225   Max.   :2916   Max.   :2764   Max.   :2783  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2578        162        156         41        114        180        259 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       186        247        534        564        135 
Trial 26 done!
******************
***************
Doing now trial 27 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 542   Min.   : 399   Min.   :1072   Min.   : 931  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2056   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3271   Max.   :3051   Max.   :2695   Max.   :2706  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2515        133        171         53        115        193        272 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       147        236        531        540        124 
Trial 27 done!
******************
***************
Doing now trial 28 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 462   Min.   : 561   Min.   : 930   Min.   : 841  
 1st Qu.:2008   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2107   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3354   Max.   :2954   Max.   :2791   Max.   :2794  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2709        162        180        114        129        199        264 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       159        256        523        570        153 
Trial 28 done!
******************
***************
Doing now trial 29 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 458   Min.   : 742   Min.   :1069   Min.   : 938  
 1st Qu.:2009   1st Qu.:2012   1st Qu.:2015   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2055   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2105   3rd Qu.:2101   3rd Qu.:2097   3rd Qu.:2104  
 Max.   :3301   Max.   :2877   Max.   :2841   Max.   :2852  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2627        162        171         54        104        136        325 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       178        215        549        568        165 
Trial 29 done!
******************
***************
Doing now trial 30 of C3H_6
The five number summary is:
       V1             V2             V3             V4      
 Min.   : 704   Min.   : 456   Min.   :1195   Min.   : 985  
 1st Qu.:2009   1st Qu.:2011   1st Qu.:2014   1st Qu.:2011  
 Median :2058   Median :2057   Median :2057   Median :2059  
 Mean   :2054   Mean   :2054   Mean   :2053   Mean   :2055  
 3rd Qu.:2106   3rd Qu.:2102   3rd Qu.:2098   3rd Qu.:2105  
 Max.   :3451   Max.   :3043   Max.   :2714   Max.   :2843  

Global counts at classification's end:
     Total  Cluster 1  Cluster 2  Cluster 3  Cluster 4  Cluster 5  Cluster 6 
      2654        153        180         86        111        202        251 
 Cluster 7  Cluster 8  Cluster 9 Cluster 10          ? 
       175        243        555        570        128 
Trial 30 done!
******************
#+end_example

** Diagnostic plots

The counts evolution is:

#+NAME: C3H_6-count-evolution-tetB
#+HEADER: :width 800 :height 800 :file C3H_6-count-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
counts_evolution(a_C3H_6_tetB)
#+END_SRC

#+CAPTION: Evolution of the number of events attributed to each unit (1 to 9 and "a") or unclassified ("?") during the 30 trials of =C3H_6= for tetrodeB.
#+RESULTS: C3H_6-count-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_6-count-evolution-tetB.png]]

The waveform evolution is:

#+NAME: C3H_6-waveform-evolution-tetB
#+HEADER: :width 800 :height 1600 :file C3H_6-waveform-evolution-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
waveform_evolution(a_C3H_6_tetB,threshold_factor,matrix(1:10,nr=5))
#+END_SRC

#+CAPTION: Evolution of the templates of each unit during the 30 trials of =C3H_6= for tetrodeB.
#+RESULTS: C3H_6-waveform-evolution-tetB
[[file:locust20010214_tetB_fig/C3H_6-waveform-evolution-tetB.png]]

The observed counting processes and inter spike intervals densities are:

#+NAME: C3H_6-CP-and-ISI-dist-tetB
#+HEADER: :width 800 :height 1600 :file C3H_6-CP-and-ISI-dist-tetB.png
#+BEGIN_SRC R :exports results :results output graphics :session *R*
cp_isi_raster(a_C3H_6_tetB,inter_trial_time=30,nbins=100)
#+END_SRC

#+CAPTION: Observed counting processes, empirical inter spike interval distributions and raster plots for =C3H_6=.
#+RESULTS: C3H_6-CP-and-ISI-dist-tetB
[[file:locust20010214_tetB_fig/C3H_6-CP-and-ISI-dist-tetB.png]]

The BRT and RFT tests give for the first 7 units:

#+NAME: C3H_6-rt-test-tetB
#+HEADER: :width 1600 :height 1600 :file C3H_6-rt-test-tetB.png
#+BEGIN_SRC R :session *R* :results output graphics :exports both
layout_matrix = matrix(0,nr=nbc-3,nc=nbc-3)
counter = 1
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j) {
            layout_matrix[i,j] = counter
            counter = counter +1
        }
layout(layout_matrix)
par(mar=c(4,3,4,1))
for (i in 1:(nbc-3))
    for (j in 1:(nbc-3))
        if (i != j)
            test_rt(a_C3H_6_tetB$spike_trains[[i]],
                    a_C3H_6_tetB$spike_trains[[j]],
		    nbins=200,single_trial_duration=30,
                    ylab="",main=paste("Units",i,"and",j))
#+END_SRC

#+CAPTION: Graphical tests for the first 7 units of the Backward and Forward Reccurrence Times distribution against the null hypothesis (no interaction) during Spontaenous_1. If the null is correct, the curves should be IID draws from a standard normal distribution.
#+RESULTS: C3H_6-rt-test-tetB
[[file:locust20010214_tetB_fig/C3H_6-rt-test-tetB.png]]

** Save results

Before analyzing the next set of trials we save the output of =sort_many_trials= to disk with:

#+NAME: save-counts-and-centers-to-disk-C3H_6
#+BEGIN_SRC R :session *R* :results silent
save(a_C3H_6_tetB,
     file=paste0("tetB_analysis/tetB_",stim_name,"_summary_obj.rda"))
#+END_SRC

We write to disk the spike trains in text mode:

#+NAME: write-spike-trains-tetB
#+BEGIN_SRC R :session *R* :results silent
for (c_idx in 1:length(a_C3H_6_tetB$spike_trains))
    if (!is.null(a_C3H_6_tetB$spike_trains[[c_idx]]))
        cat(a_C3H_6_tetB$spike_trains[[c_idx]],file=paste0("locust20010214_spike_trains/locust20010214_C3H_6_tetB_u",c_idx,".txt"),sep="\n")
#+END_SRC

